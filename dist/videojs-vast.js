!function(name,context,definition){"undefined"!=typeof module&&module.exports?module.exports=definition():"function"==typeof define&&define.amd?define(definition):context[name]=definition()}("Fingerprint",this,function(){"use strict";var Fingerprint=function(options){var nativeForEach,nativeMap;nativeForEach=Array.prototype.forEach,nativeMap=Array.prototype.map,this.each=function(obj,iterator,context){if(null!==obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++)if(iterator.call(context,obj[i],i,obj)==={})return}else for(var key in obj)if(obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj)==={})return},this.map=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(this.each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)}),results)},"object"==typeof options?(this.hasher=options.hasher,this.screen_resolution=options.screen_resolution,this.screen_orientation=options.screen_orientation,this.canvas=options.canvas,this.ie_activex=options.ie_activex):"function"==typeof options&&(this.hasher=options)};return Fingerprint.prototype={get:function(){var keys=[];if(keys.push(navigator.userAgent),keys.push(navigator.language),keys.push(screen.colorDepth),this.screen_resolution){var resolution=this.getScreenResolution();"undefined"!=typeof resolution&&keys.push(resolution.join("x"))}return keys.push((new Date).getTimezoneOffset()),keys.push(this.hasSessionStorage()),keys.push(this.hasLocalStorage()),keys.push(!!window.indexedDB),document.body?keys.push(typeof document.body.addBehavior):keys.push("undefined"),keys.push(typeof window.openDatabase),keys.push(navigator.cpuClass),keys.push(navigator.platform),keys.push(navigator.doNotTrack),keys.push(this.getPluginsString()),this.canvas&&this.isCanvasSupported()&&keys.push(this.getCanvasFingerprint()),this.hasher?this.hasher(keys.join("###"),31):this.murmurhash3_32_gc(keys.join("###"),31)},murmurhash3_32_gc:function(key,seed){var remainder,bytes,h1,h1b,c1,c2,k1,i;for(remainder=3&key.length,bytes=key.length-remainder,h1=seed,c1=3432918353,c2=461845907,i=0;i<bytes;)k1=255&key.charCodeAt(i)|(255&key.charCodeAt(++i))<<8|(255&key.charCodeAt(++i))<<16|(255&key.charCodeAt(++i))<<24,++i,k1=(65535&k1)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295,k1=k1<<15|k1>>>17,k1=(65535&k1)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295,h1^=k1,h1=h1<<13|h1>>>19,h1b=5*(65535&h1)+((5*(h1>>>16)&65535)<<16)&4294967295,h1=(65535&h1b)+27492+(((h1b>>>16)+58964&65535)<<16);switch(k1=0,remainder){case 3:k1^=(255&key.charCodeAt(i+2))<<16;case 2:k1^=(255&key.charCodeAt(i+1))<<8;case 1:k1^=255&key.charCodeAt(i),k1=(65535&k1)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295,k1=k1<<15|k1>>>17,k1=(65535&k1)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295,h1^=k1}return h1^=key.length,h1^=h1>>>16,h1=2246822507*(65535&h1)+((2246822507*(h1>>>16)&65535)<<16)&4294967295,h1^=h1>>>13,h1=3266489909*(65535&h1)+((3266489909*(h1>>>16)&65535)<<16)&4294967295,h1^=h1>>>16,h1>>>0},hasLocalStorage:function(){try{return!!window.localStorage}catch(e){return!0}},hasSessionStorage:function(){try{return!!window.sessionStorage}catch(e){return!0}},isCanvasSupported:function(){var elem=document.createElement("canvas");return!(!elem.getContext||!elem.getContext("2d"))},isIE:function(){return"Microsoft Internet Explorer"===navigator.appName||!("Netscape"!==navigator.appName||!/Trident/.test(navigator.userAgent))},getPluginsString:function(){return this.isIE()&&this.ie_activex?this.getIEPluginsString():this.getRegularPluginsString()},getRegularPluginsString:function(){return this.map(navigator.plugins,function(p){var mimeTypes=this.map(p,function(mt){return[mt.type,mt.suffixes].join("~")}).join(",");return[p.name,p.description,mimeTypes].join("::")},this).join(";")},getIEPluginsString:function(){if(window.ActiveXObject){var names=["ShockwaveFlash.ShockwaveFlash","AcroPDF.PDF","PDF.PdfCtrl","QuickTime.QuickTime","rmocx.RealPlayer G2 Control","rmocx.RealPlayer G2 Control.1","RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)","RealVideo.RealVideo(tm) ActiveX Control (32-bit)","RealPlayer","SWCtl.SWCtl","WMPlayer.OCX","AgControl.AgControl","Skype.Detection"];return this.map(names,function(name){try{return new ActiveXObject(name),name}catch(e){return null}}).join(";")}return""},getScreenResolution:function(){var resolution;return resolution=this.screen_orientation?screen.height>screen.width?[screen.height,screen.width]:[screen.width,screen.height]:[screen.height,screen.width]},getCanvasFingerprint:function(){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),txt="clickyab";return ctx.textBaseline="top",ctx.font="14px 'Arial'",ctx.textBaseline="alphabetic",ctx.fillStyle="#f60",ctx.fillRect(125,1,62,20),ctx.fillStyle="#069",ctx.fillText(txt,2,15),ctx.fillStyle="rgba(102, 204, 0, 0.7)",ctx.fillText(txt,4,17),canvas.toDataURL()}},Fingerprint});var fp=new Fingerprint,uid=fp.get();!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.VMAP=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var ADBreak;ADBreak=function(){function ADBreak(){this.breakType=null,this.timeOffset=null,this.breakId=null,this.allowMultipleAds=!1,this.followRedirects=!0,this.id=null,this.templateType=null,this.vastAdData=null,this.adTagURI=null,this.isWrapper=!1,this.trackingEvent=null}return ADBreak}(),module.exports=ADBreak},{}],2:[function(require,module,exports){var ADSource;ADSource=function(){function ADSource(){this.allowMultipleAds=!1,this.followRedirects=!1,this.id=null,this.templateType=null,this.vastAdData=null,this.adTagURI=null,this.isWrapper=!1}return ADSource}(),module.exports=ADSource},{}],3:[function(require,module,exports){var VMAPClient,VMAPParser,VMAPUtil;VMAPParser=require("./parser.coffee"),VMAPUtil=require("./vmaputil.coffee"),VMAPClient=function(){function VMAPClient(){}return VMAPClient.options={withCredentials:!0,timeout:0},VMAPClient.get=function(url,opts,cb){var extend,options;return extend=exports.extend=function(object,properties){var key,val;for(key in properties)val=properties[key],object[key]=val;return object},cb||("function"==typeof opts&&(cb=opts),options={}),options=extend(this.options,opts),VMAPParser.parse(url,options,function(_this){return function(response){return cb(response)}}(this))},VMAPClient}(),module.exports=VMAPClient},{"./parser.coffee":5,"./vmaputil.coffee":10}],4:[function(require,module,exports){var EventEmitter,EventTracker,VMAPUtil,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;VMAPUtil=require("./vmaputil.coffee"),EventEmitter=require("events").EventEmitter,EventTracker=function(superClass){function EventTracker(trackingEvents){this.trackingEvents=trackingEvents}return extend(EventTracker,superClass),EventTracker.prototype.breakStart=function(){return this.track("breakStart")},EventTracker.prototype.breakEnd=function(){return this.track("breakEnd")},EventTracker.prototype.error=function(error){return this.track("error",!1,error)},EventTracker.prototype.track=function(eventName,once,variables){var trackingURLTemplates;null==once&&(once=!1),trackingURLTemplates=this.trackingEvents[eventName],null!=trackingURLTemplates&&this.trackURLs(trackingURLTemplates),once===!0&&delete this.trackingEvents[eventName]},EventTracker.prototype.trackURLs=function(URLTemplates,variables){return null==variables&&(variables={}),VMAPUtil.track(URLTemplates,variables)},EventTracker}(EventEmitter),module.exports=EventTracker},{"./vmaputil.coffee":10,events:11}],5:[function(require,module,exports){var AdBreak,AdSource,EventEmitter,URLHandler,VMAPParser,VMAPResponse,VMAPUtil;URLHandler=require("./urlhandler.coffee"),AdBreak=require("./adbreak.coffee"),AdSource=require("./addata.coffee"),VMAPResponse=require("./vmapresponse.coffee"),EventEmitter=require("events").EventEmitter,VMAPUtil=require("./vmaputil.coffee"),VMAPParser=function(){function VMAPParser(){}return VMAPParser.parse=function(url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),this._parse(url,null,options,function(err,response){return cb(response)})},VMAPParser.vent=new EventEmitter,VMAPParser.track=function(templates,errorCode){return this.vent.emit("VMAP-error",errorCode),VMAPUtil.track(templates,errorCode)},VMAPParser._parseSource=function(err,xml,cb){var adBreak,complete,extensions,i,j,len,len1,node,ref,ref1,response;if(null!=err)return cb(err);if(response=new VMAPResponse,response.adbreaks=[],null==(null!=xml?xml.documentElement:void 0)||"VMAP"!==xml.documentElement.nodeName&&"VMAP"!==xml.documentElement.nodeName)return cb();for(ref=xml.documentElement.childNodes,i=0,len=ref.length;i<len;i++)node=ref[i],"Error"===node.nodeName&&response.errorURLTemplates.push(this.parseNodeText(node));for(ref1=xml.documentElement.childNodes,j=0,len1=ref1.length;j<len1;j++)switch(node=ref1[j],node.nodeName){case"AdBreak":adBreak=this.parseAdBreakElement(node),null!=adBreak&&"end"!=adBreak.timeOffset?response.adbreaks.push(adBreak):this.track(response.errorURLTemplates,{ERRORCODE:101});break;case"Extensions":extensions=this.parseExtensionElement(node)}return(complete=function(_this){return function(errorAlreadyRaised){if(null==errorAlreadyRaised&&(errorAlreadyRaised=!1),response)return 0===response.adbreaks.length&&(errorAlreadyRaised||_this.track(response.errorURLTemplates,{ERRORCODE:303}),response=null),cb(null,response)}}(this))()},VMAPParser._parse=function(url,parentURLs,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),URLHandler.get(url,options,function(_this){return function(err,xml){return _this._parseSource(err,xml,cb)}}(this))},VMAPParser.parseExtensionElement=function(extensionsElement){return null},VMAPParser.parseAdBreakElement=function(adBreakElement){var adBreak,adSource,extensions,i,len,node,ref,trackingEvents;for(adBreak=new AdBreak,adBreak.breakType=adBreakElement.getAttribute("breakType"),adBreak.breakId=adBreakElement.getAttribute("breakId"),adBreak.timeOffset=adBreakElement.getAttribute("timeOffset"),ref=adBreakElement.childNodes,i=0,len=ref.length;i<len;i++)switch(node=ref[i],node.nodeName){case"AdSource":adSource=this.parseAdSource(node),adSource&&(adBreak.allowMultipleAds=adSource.allowMultipleAds,adBreak.followRedirects=adSource.followRedirects,adBreak.id=adSource.id,adBreak.templateType=adSource.templateType,adBreak.vastAdData=adSource.vastAdData,adBreak.adTagURI=adSource.adTagURI,adBreak.isWrapper=adSource.isWrapper);break;case"TrackingEvents":trackingEvents=this.parseTrackingEvent(node),trackingEvents&&(adBreak.trackingEvent=trackingEvents);break;case"Extensions":extensions=this.parseExtensionElement(node)}return adBreak},VMAPParser.parseTrackingEvent=function(trackingEventElement){var i,len,ref,trackingElement,trackingEvent;for(trackingEvent={},trackingEvent.breakStart=[],trackingEvent.breakEnd=[],trackingEvent.error=[],ref=trackingEventElement.childNodes,i=0,len=ref.length;i<len;i++)if(trackingElement=ref[i],void 0!==trackingElement.getAttribute)switch(trackingElement.getAttribute("event")){case"breakStart":trackingEvent.breakStart.push(this.parseNodeText(trackingElement));break;case"breakEnd":trackingEvent.breakEnd.push(this.parseNodeText(trackingElement));break;case"error":trackingEvent.error.push(this.parseNodeText(trackingElement))}return trackingEvent},VMAPParser.parseAdSource=function(adSourceElement){var adSource,i,len,node,ref;for(adSource=new AdSource,adSource.allowMultipleAds=VMAPUtil.parseBoolean(adSourceElement.getAttribute("allowMultipleAds")),adSource.followRedirects=VMAPUtil.parseBoolean(adSourceElement.getAttribute("followRedirects")),adSource.id=adSourceElement.getAttribute("id"),ref=adSourceElement.childNodes,i=0,len=ref.length;i<len;i++)switch(node=ref[i],node.nodeName){case"VASTData":adSource.vastAdData=node.childNodes,adSource.templateType="vast3";break;case"AdTagURI":adSource.adTagURI=this.parseNodeText(node),adSource.templateType=node.getAttribute("templateType"),adSource.isWrapper=!0;break;case"CustomAdData":adSource.vastAdData=node.childNodes,adSource.templateType=node.getAttribute("templateType")}return adSource},VMAPParser.parseNodeText=function(node){return node&&(node.textContent||node.text||"").trim()},VMAPParser.isUrl=function(node){return/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?\/\/=]*)/i.test(this.parseNodeText(node))},VMAPParser}(),module.exports=VMAPParser},{"./adbreak.coffee":1,"./addata.coffee":2,"./urlhandler.coffee":6,"./vmapresponse.coffee":9,"./vmaputil.coffee":10,events:11}],6:[function(require,module,exports){var URLHandler,flash,xhr;xhr=require("./urlhandlers/xmlhttprequest.coffee"),flash=require("./urlhandlers/flash.coffee"),URLHandler=function(){function URLHandler(){}return URLHandler.get=function(url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),options.urlhandler&&options.urlhandler.supported()?options.urlhandler.get(url,options,cb):"undefined"==typeof window||null===window?require("./urlhandlers/node.coffee").get(url,options,cb):xhr.supported()?xhr.get(url,options,cb):flash.supported()?flash.get(url,options,cb):cb()},URLHandler}(),module.exports=URLHandler},{"./urlhandlers/flash.coffee":7,"./urlhandlers/xmlhttprequest.coffee":8}],7:[function(require,module,exports){var FlashURLHandler;FlashURLHandler=function(){function FlashURLHandler(){}return FlashURLHandler.xdr=function(){var xdr;return window.XDomainRequest&&(xdr=new XDomainRequest),xdr},FlashURLHandler.supported=function(){return!!this.xdr()},FlashURLHandler.get=function(url,options,cb){var xdr,xmlDocument;return(xmlDocument="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(xmlDocument.async=!1,xdr=this.xdr(),xdr.open("GET",url),xdr.timeout=options.timeout||0,xdr.withCredentials=options.withCredentials||!1,xdr.send(),xdr.onload=function(){return xmlDocument.loadXML(xdr.responseText),cb(null,xmlDocument)}):cb()},FlashURLHandler}(),module.exports=FlashURLHandler},{}],8:[function(require,module,exports){var XHRURLHandler;XHRURLHandler=function(){function XHRURLHandler(){}return XHRURLHandler.xhr=function(){var xhr;if(xhr=new window.XMLHttpRequest,"withCredentials"in xhr)return xhr},XHRURLHandler.supported=function(){return!!this.xhr()},XHRURLHandler.get=function(url,options,cb){var xhr;try{return xhr=this.xhr(),url=url+"&tid="+uid+"&l=1",xhr.open("GET",url),xhr.timeout=options.timeout||0,xhr.withCredentials=options.withCredentials||!1,xhr.send(),xhr.onreadystatechange=function(){if(4===xhr.readyState)return cb(null,xhr.responseXML)}}catch(error){return cb()}},XHRURLHandler}(),module.exports=XHRURLHandler},{}],9:[function(require,module,exports){var VMAPResponse;VMAPResponse=function(){function VMAPResponse(){}return VMAPResponse.adbreaks=[],VMAPResponse}(),module.exports=VMAPResponse},{}],10:[function(require,module,exports){var VMAPUtil;VMAPUtil=function(){function VMAPUtil(){}return VMAPUtil.track=function(URLTemplates,variables){var URL,URLs,i,j,len,results;if(null!=URLTemplates){for(URLs=this.resolveURLTemplates(URLTemplates,variables),results=[],j=0,len=URLs.length;j<len;j++)URL=URLs[j],"undefined"!=typeof window&&null!==window&&(i=new Image,results.push(i.src=URL));return results}},VMAPUtil.resolveURLTemplates=function(URLTemplates,variables){var URLTemplate,URLs,j,key,len,macro1,macro2,resolveURL,value;URLs=[],null==variables&&(variables={}),"CACHEBUSTING"in variables||(variables.CACHEBUSTING=Math.round(1e10*Math.random())),variables.random=variables.CACHEBUSTING;for(j=0,len=URLTemplates.length;j<len;j++)if(URLTemplate=URLTemplates[j],resolveURL=URLTemplate){for(key in variables)value=variables[key],macro1="["+key+"]",macro2="%%"+key+"%%",resolveURL=resolveURL.replace(macro1,value),resolveURL=resolveURL.replace(macro2,value);URLs.push(resolveURL)}return URLs},VMAPUtil.parseBoolean=function(string){var bool;if(bool=function(){switch(!1){case"true"!==string.toLowerCase():return!0;case"false"!==string.toLowerCase():return!1}}(),"boolean"==typeof bool)return bool},VMAPUtil}(),module.exports=VMAPUtil},{}],11:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],12:[function(require,module,exports){module.exports={client:require("./client.coffee"),parser:require("./parser.coffee"),util:require("./vmaputil.coffee"),tracker:require("./eventtracker.coffee")}},{"./client.coffee":3,"./eventtracker.coffee":4,"./parser.coffee":5,"./vmaputil.coffee":10}]},{},[12])(12)}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.DMVAST=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],2:[function(_dereq_,module,exports){var VASTAd;VASTAd=function(){function VASTAd(){this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]}return VASTAd}(),module.exports=VASTAd},{}],3:[function(_dereq_,module,exports){var VASTClient,VASTParser,VASTUtil;VASTParser=_dereq_("./parser.coffee"),VASTUtil=_dereq_("./util.coffee"),VASTClient=function(){function VASTClient(){}return VASTClient.cappingFreeLunch=0,VASTClient.cappingMinimumTimeInterval=0,VASTClient.options={withCredentials:!1,timeout:0},VASTClient.get=function(url,opts,cb){var extend,now,options;return now=+new Date,extend=exports.extend=function(object,properties){var key,val;for(key in properties)val=properties[key],object[key]=val;return object},cb||("function"==typeof opts&&(cb=opts),options={}),options=extend(this.options,opts),this.totalCallsTimeout<now?(this.totalCalls=1,this.totalCallsTimeout=now+36e5):this.totalCalls++,this.cappingFreeLunch>=this.totalCalls?void cb(null):now-this.lastSuccessfullAd<this.cappingMinimumTimeInterval?void cb(null):VASTParser.parse(url,options,function(_this){return function(response){return cb(response)}}(this))},VASTClient.parse=function(xml,url,opts,cb){var extend,now,options;return now=+new Date,extend=exports.extend=function(object,properties){var key,val;for(key in properties)val=properties[key],object[key]=val;return object},cb||("function"==typeof opts&&(cb=opts),options={}),options=extend(this.options,opts),this.totalCallsTimeout<now?(this.totalCalls=1,this.totalCallsTimeout=now+36e5):this.totalCalls++,this.cappingFreeLunch>=this.totalCalls?void cb(null):now-this.lastSuccessfullAd<this.cappingMinimumTimeInterval?void cb(null):VASTParser.parseContent(xml,url,options,function(_this){return function(response){return cb(response)}}(this))},function(){var defineProperty,storage;storage=VASTUtil.storage,defineProperty=Object.defineProperty,["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach(function(property){defineProperty(VASTClient,property,{get:function(){return storage.getItem(property)},set:function(value){return storage.setItem(property,value)},configurable:!1,enumerable:!0})}),null==VASTClient.totalCalls&&(VASTClient.totalCalls=0),null==VASTClient.totalCallsTimeout&&(VASTClient.totalCallsTimeout=0)}(),VASTClient}(),module.exports=VASTClient},{"./parser.coffee":9,"./util.coffee":15}],4:[function(_dereq_,module,exports){var VASTCompanionAd;VASTCompanionAd=function(){function VASTCompanionAd(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.companionClickThroughURLTemplate=null,this.trackingEvents={}}return VASTCompanionAd}(),module.exports=VASTCompanionAd},{}],5:[function(_dereq_,module,exports){var VASTCreative,VASTCreativeCompanion,VASTCreativeLinear,VASTCreativeNonLinear,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};VASTCreative=function(){function VASTCreative(){this.trackingEvents={}}return VASTCreative}(),VASTCreativeLinear=function(_super){function VASTCreativeLinear(){VASTCreativeLinear.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[]}return __extends(VASTCreativeLinear,_super),VASTCreativeLinear}(VASTCreative),VASTCreativeNonLinear=function(_super){function VASTCreativeNonLinear(){return VASTCreativeNonLinear.__super__.constructor.apply(this,arguments)}return __extends(VASTCreativeNonLinear,_super),VASTCreativeNonLinear}(VASTCreative),VASTCreativeCompanion=function(_super){function VASTCreativeCompanion(){this.type="companion",this.variations=[],this.videoClickTrackingURLTemplates=[]}return __extends(VASTCreativeCompanion,_super),VASTCreativeCompanion}(VASTCreative),module.exports={VASTCreativeLinear:VASTCreativeLinear,VASTCreativeNonLinear:VASTCreativeNonLinear,VASTCreativeCompanion:VASTCreativeCompanion}},{}],6:[function(_dereq_,module,exports){var VASTExtension;VASTExtension=function(){function VASTExtension(){this.name="",this.attributes={},this.children={},this.textContent=""}return VASTExtension}(),module.exports=VASTExtension},{}],7:[function(_dereq_,module,exports){module.exports={client:_dereq_("./client.coffee"),tracker:_dereq_("./tracker.coffee"),parser:_dereq_("./parser.coffee"),util:_dereq_("./util.coffee")}},{"./client.coffee":3,"./parser.coffee":9,"./tracker.coffee":11,"./util.coffee":15}],8:[function(_dereq_,module,exports){var VASTMediaFile;VASTMediaFile=function(){function VASTMediaFile(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,
this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}return VASTMediaFile}(),module.exports=VASTMediaFile},{}],9:[function(_dereq_,module,exports){var EventEmitter,URLHandler,VASTAd,VASTCompanionAd,VASTCreativeCompanion,VASTCreativeLinear,VASTExtension,VASTMediaFile,VASTParser,VASTResponse,VASTUtil,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};URLHandler=_dereq_("./urlhandler.coffee"),VASTResponse=_dereq_("./response.coffee"),VASTAd=_dereq_("./ad.coffee"),VASTUtil=_dereq_("./util.coffee"),VASTCreativeLinear=_dereq_("./creative.coffee").VASTCreativeLinear,VASTCreativeCompanion=_dereq_("./creative.coffee").VASTCreativeCompanion,VASTExtension=_dereq_("./extension.coffee"),VASTMediaFile=_dereq_("./mediafile.coffee"),VASTCompanionAd=_dereq_("./companionad.coffee"),EventEmitter=_dereq_("events").EventEmitter,VASTParser=function(){function VASTParser(){}var URLTemplateFilters;return URLTemplateFilters=[],VASTParser.addURLTemplateFilter=function(func){"function"==typeof func&&URLTemplateFilters.push(func)},VASTParser.removeURLTemplateFilter=function(){return URLTemplateFilters.pop()},VASTParser.countURLTemplateFilters=function(){return URLTemplateFilters.length},VASTParser.clearUrlTemplateFilters=function(){return URLTemplateFilters=[]},VASTParser.parse=function(url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),this._parse(url,null,options,function(err,response){return cb(response)})},VASTParser.parseContent=function(xml,url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),this._parseContent(xml,url,null,options,function(err,response){return cb(response)})},VASTParser.vent=new EventEmitter,VASTParser.track=function(templates,errorCode){return this.vent.emit("VAST-error",errorCode),VASTUtil.track(templates,errorCode)},VASTParser.on=function(eventName,cb){return this.vent.on(eventName,cb)},VASTParser.once=function(eventName,cb){return this.vent.once(eventName,cb)},VASTParser._parse=function(url,parentURLs,options,cb){var filter,_i,_len;for(cb||("function"==typeof options&&(cb=options),options={}),_i=0,_len=URLTemplateFilters.length;_i<_len;_i++)filter=URLTemplateFilters[_i],url=filter(url);return null==parentURLs&&(parentURLs=[]),parentURLs.push(url),URLHandler.get(url,options,function(_this){return function(err,xml){return null!=err?cb(err):_this._parseNode(url,xml,parentURLs,options,cb)}}(this))},VASTParser._parseContent=function(xml,url,parentURLs,options,cb){var filter,_i,_len;for(cb||("function"==typeof options&&(cb=options),options={}),_i=0,_len=URLTemplateFilters.length;_i<_len;_i++)filter=URLTemplateFilters[_i],url=filter(url);return null==parentURLs&&(parentURLs=[]),parentURLs.push(url),this._parseNode(url,xml,parentURLs,options,cb)},VASTParser._parseNode=function(url,xml,parentURLs,options,cb){var ad,complete,loopIndex,node,response,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3;if(response=new VASTResponse,(null==(null!=xml?xml.documentElement:void 0)||"VAST"!==xml.documentElement.nodeName&&"VideoAdServingTemplate"!==xml.documentElement.nodeName)&&(null==(null!=xml?xml.nodeName:void 0)||"VAST"!==xml.nodeName&&"VideoAdServingTemplate"!==xml.nodeName))return cb;if(null!=(null!=xml?xml.documentElement:void 0)){for(_ref=xml.documentElement.childNodes,_i=0,_len=_ref.length;_i<_len;_i++)node=_ref[_i],"Error"===node.nodeName&&response.errorURLTemplates.push(this.parseNodeText(node));for(_ref1=xml.documentElement.childNodes,_j=0,_len1=_ref1.length;_j<_len1;_j++)node=_ref1[_j],"Ad"===node.nodeName&&(ad=this.parseAdElement(node),null!=ad?response.ads.push(ad):this.track(response.errorURLTemplates,{ERRORCODE:101}))}else{for(_ref2=xml.childNodes,_k=0,_len2=_ref2.length;_k<_len2;_k++)node=_ref2[_k],"Error"===node.nodeName&&response.errorURLTemplates.push(this.parseNodeText(node));for(_ref3=xml.childNodes,_l=0,_len3=_ref3.length;_l<_len3;_l++)node=_ref3[_l],"Ad"===node.nodeName&&(ad=this.parseAdElement(node),null!=ad?response.ads.push(ad):this.track(response.errorURLTemplates,{ERRORCODE:101}))}for(complete=function(_this){return function(errorAlreadyRaised){var _len4,_m,_ref4;if(null==errorAlreadyRaised&&(errorAlreadyRaised=!1),response){for(_ref4=response.ads,_m=0,_len4=_ref4.length;_m<_len4;_m++)if(ad=_ref4[_m],null!=ad.nextWrapperURL)return;return 0===response.ads.length&&(errorAlreadyRaised||_this.track(response.errorURLTemplates,{ERRORCODE:303}),response=null),cb(null,response)}}}(this),loopIndex=response.ads.length;loopIndex--;)ad=response.ads[loopIndex],null!=ad.nextWrapperURL&&!function(_this){return function(ad){var baseURL,_ref4;return parentURLs.length>=10||(_ref4=ad.nextWrapperURL,__indexOf.call(parentURLs,_ref4)>=0)?(_this.track(ad.errorURLTemplates,{ERRORCODE:302}),response.ads.splice(response.ads.indexOf(ad),1),void complete()):(ad.nextWrapperURL.indexOf("://")===-1&&(baseURL=url.slice(0,url.lastIndexOf("/")),ad.nextWrapperURL=""+baseURL+"/"+ad.nextWrapperURL),_this._parse(ad.nextWrapperURL,parentURLs,options,function(err,wrappedResponse){var creative,errorAlreadyRaised,eventName,index,wrappedAd,_base,_len4,_len5,_len6,_len7,_m,_n,_o,_p,_ref5,_ref6,_ref7,_ref8;if(errorAlreadyRaised=!1,null!=err)_this.track(ad.errorURLTemplates,{ERRORCODE:301}),response.ads.splice(response.ads.indexOf(ad),1),errorAlreadyRaised=!0;else if(null==wrappedResponse)_this.track(ad.errorURLTemplates,{ERRORCODE:303}),response.ads.splice(response.ads.indexOf(ad),1),errorAlreadyRaised=!0;else for(response.errorURLTemplates=response.errorURLTemplates.concat(wrappedResponse.errorURLTemplates),index=response.ads.indexOf(ad),response.ads.splice(index,1),_ref5=wrappedResponse.ads,_m=0,_len4=_ref5.length;_m<_len4;_m++){if(wrappedAd=_ref5[_m],wrappedAd.errorURLTemplates=ad.errorURLTemplates.concat(wrappedAd.errorURLTemplates),wrappedAd.impressionURLTemplates=ad.impressionURLTemplates.concat(wrappedAd.impressionURLTemplates),null!=ad.trackingEvents)for(_ref6=wrappedAd.creatives,_n=0,_len5=_ref6.length;_n<_len5;_n++)if(creative=_ref6[_n],"linear"===creative.type)for(_ref7=Object.keys(ad.trackingEvents),_o=0,_len6=_ref7.length;_o<_len6;_o++)eventName=_ref7[_o],(_base=creative.trackingEvents)[eventName]||(_base[eventName]=[]),creative.trackingEvents[eventName]=creative.trackingEvents[eventName].concat(ad.trackingEvents[eventName]);if(null!=ad.videoClickTrackingURLTemplates)for(_ref8=wrappedAd.creatives,_p=0,_len7=_ref8.length;_p<_len7;_p++)creative=_ref8[_p],"linear"===creative.type&&(creative.videoClickTrackingURLTemplates=creative.videoClickTrackingURLTemplates.concat(ad.videoClickTrackingURLTemplates));response.ads.splice(index,0,wrappedAd)}return delete ad.nextWrapperURL,complete(errorAlreadyRaised)}))}}(this)(ad);return complete()},VASTParser.childByName=function(node,name){var child,_i,_len,_ref;for(_ref=node.childNodes,_i=0,_len=_ref.length;_i<_len;_i++)if(child=_ref[_i],child.nodeName===name)return child},VASTParser.childsByName=function(node,name){var child,childs,_i,_len,_ref;for(childs=[],_ref=node.childNodes,_i=0,_len=_ref.length;_i<_len;_i++)child=_ref[_i],child.nodeName===name&&childs.push(child);return childs},VASTParser.parseAdElement=function(adElement){var adTypeElement,_i,_len,_ref;for(_ref=adElement.childNodes,_i=0,_len=_ref.length;_i<_len;_i++){if(adTypeElement=_ref[_i],"Wrapper"===adTypeElement.nodeName)return this.parseWrapperElement(adTypeElement);if("InLine"===adTypeElement.nodeName)return this.parseInLineElement(adTypeElement)}},VASTParser.parseWrapperElement=function(wrapperElement){var ad,creative,wrapperCreativeElement,wrapperURLElement,_i,_len,_ref;for(ad=this.parseInLineElement(wrapperElement),wrapperURLElement=this.childByName(wrapperElement,"VASTAdTagURI"),null!=wrapperURLElement?ad.nextWrapperURL=this.parseNodeText(wrapperURLElement):(wrapperURLElement=this.childByName(wrapperElement,"VASTAdTagURL"),null!=wrapperURLElement&&(ad.nextWrapperURL=this.parseNodeText(this.childByName(wrapperURLElement,"URL")))),wrapperCreativeElement=null,_ref=ad.creatives,_i=0,_len=_ref.length;_i<_len;_i++)if(creative=_ref[_i],"linear"===creative.type){wrapperCreativeElement=creative;break}if(null!=wrapperCreativeElement&&(null!=wrapperCreativeElement.trackingEvents&&(ad.trackingEvents=wrapperCreativeElement.trackingEvents),null!=wrapperCreativeElement.videoClickTrackingURLTemplates&&(ad.videoClickTrackingURLTemplates=wrapperCreativeElement.videoClickTrackingURLTemplates)),null!=ad.nextWrapperURL)return ad},VASTParser.parseInLineElement=function(inLineElement){var ad,creative,creativeElement,creativeTypeElement,extensionElement,node,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3;for(ad=new VASTAd,_ref=inLineElement.childNodes,_i=0,_len=_ref.length;_i<_len;_i++)switch(node=_ref[_i],node.nodeName){case"Error":this.isUrl(node)&&ad.errorURLTemplates.push(this.parseNodeText(node));break;case"Impression":this.isUrl(node)&&ad.impressionURLTemplates.push(this.parseNodeText(node));break;case"Creatives":for(_ref1=this.childsByName(node,"Creative"),_j=0,_len1=_ref1.length;_j<_len1;_j++)for(creativeElement=_ref1[_j],_ref2=creativeElement.childNodes,_k=0,_len2=_ref2.length;_k<_len2;_k++)switch(creativeTypeElement=_ref2[_k],creativeTypeElement.nodeName){case"Linear":creative=this.parseCreativeLinearElement(creativeTypeElement),creative&&ad.creatives.push(creative);break;case"CompanionAds":creative=this.parseCompanionAd(creativeTypeElement),creative&&ad.creatives.push(creative)}break;case"Video":creative=this.parseDeprecatedLinearElement(node.parentNode),creative&&ad.creatives.push(creative);break;case"CompanionAds":creative=this.parseDeprecatedCompanionAd(node),creative&&ad.creatives.push(creative);break;case"Extensions":for(_ref3=this.childsByName(node,"Extension"),_l=0,_len3=_ref3.length;_l<_len3;_l++)extensionElement=_ref3[_l],ad.extensions.push(this.parseExtensionElement(extensionElement))}return ad},VASTParser.parseExtensionElement=function(extensionElement){var attribute,child,extension,_i,_j,_len,_len1,_ref,_ref1;if(extension=new VASTExtension,extension.name=extensionElement.nodeName,extensionElement.hasAttributes())for(_ref=extensionElement.attributes,_i=0,_len=_ref.length;_i<_len;_i++)attribute=_ref[_i],extension.attributes[attribute.name]=attribute.value;if(extensionElement.hasChildNodes())for(_ref1=extensionElement.childNodes,_j=0,_len1=_ref1.length;_j<_len1;_j++)child=_ref1[_j],child.nodeType===Node.ELEMENT_NODE?extension.children[child.nodeName]=this.parseExtensionElement(child):child.nodeType===Node.CDATA_SECTION_NODE&&(extension.textContent=child.textContent);return extension},VASTParser.parseDeprecatedLinearElement=function(creativeElement){var creative,eventName,maintainAspectRatio,mediaFile,mediaFileElement,mediaFilesElement,scalable,trackingElement,trackingEventsElement,trackingURLTemplate,video,_base,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3;for(creative=new VASTCreativeLinear,video=this.childByName(creativeElement,"Video"),creative.duration=this.parseDuration(this.parseNodeText(this.childByName(video,"Duration"))),_ref=this.childsByName(creativeElement,"TrackingEvents"),_i=0,_len=_ref.length;_i<_len;_i++)for(trackingEventsElement=_ref[_i],_ref1=this.childsByName(trackingEventsElement,"Tracking"),_j=0,_len1=_ref1.length;_j<_len1;_j++)trackingElement=_ref1[_j],eventName=trackingElement.getAttribute("event"),trackingURLTemplate=this.parseNodeText(trackingElement),null!=eventName&&null!=trackingURLTemplate&&(null==(_base=creative.trackingEvents)[eventName]&&(_base[eventName]=[]),creative.trackingEvents[eventName].push(trackingURLTemplate));for(_ref2=this.childsByName(video,"MediaFiles"),_k=0,_len2=_ref2.length;_k<_len2;_k++)for(mediaFilesElement=_ref2[_k],_ref3=this.childsByName(mediaFilesElement,"MediaFile"),_l=0,_len3=_ref3.length;_l<_len3;_l++)mediaFileElement=_ref3[_l],mediaFile=new VASTMediaFile,mediaFile.id=mediaFileElement.getAttribute("id"),mediaFile.fileURL=this.parseNodeText(mediaFileElement),mediaFile.deliveryType=mediaFileElement.getAttribute("delivery"),mediaFile.codec=mediaFileElement.getAttribute("codec"),mediaFile.mimeType=mediaFileElement.getAttribute("type"),"video/x-mp4"===mediaFile.mimeType&&(mediaFile.mimeType="video/mp4"),mediaFile.apiFramework=mediaFileElement.getAttribute("apiFramework"),mediaFile.bitrate=parseInt(mediaFileElement.getAttribute("bitrate")||0),mediaFile.minBitrate=parseInt(mediaFileElement.getAttribute("minBitrate")||0),mediaFile.maxBitrate=parseInt(mediaFileElement.getAttribute("maxBitrate")||0),mediaFile.width=parseInt(mediaFileElement.getAttribute("width")||0),mediaFile.height=parseInt(mediaFileElement.getAttribute("height")||0),scalable=mediaFileElement.getAttribute("scalable"),scalable&&"string"==typeof scalable&&(scalable=scalable.toLowerCase(),"true"===scalable?mediaFile.scalable=!0:"false"===scalable&&(mediaFile.scalable=!1)),maintainAspectRatio=mediaFileElement.getAttribute("maintainAspectRatio"),maintainAspectRatio&&"string"==typeof maintainAspectRatio&&(maintainAspectRatio=maintainAspectRatio.toLowerCase(),"true"===maintainAspectRatio?mediaFile.maintainAspectRatio=!0:"false"===maintainAspectRatio&&(mediaFile.maintainAspectRatio=!1)),creative.mediaFiles.push(mediaFile);return creative},VASTParser.parseCreativeLinearElement=function(creativeElement){var clickTrackingElement,creative,eventName,maintainAspectRatio,mediaFile,mediaFileElement,mediaFilesElement,percent,scalable,skipOffset,trackingElement,trackingEventsElement,trackingURLTemplate,videoClicksElement,_base,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref,_ref1,_ref2,_ref3,_ref4;if(creative=new VASTCreativeLinear,creative.duration=this.parseDuration(this.parseNodeText(this.childByName(creativeElement,"Duration"))),creative.duration===-1&&"Wrapper"!==creativeElement.parentNode.parentNode.parentNode.nodeName)return null;if(skipOffset=creativeElement.getAttribute("skipOffset"),null==skipOffset?creative.skipDelay=null:"%"===skipOffset.charAt(skipOffset.length-1)?(percent=parseInt(skipOffset,10),creative.skipDelay=creative.duration*(percent/100)):creative.skipDelay=this.parseDuration(skipOffset),videoClicksElement=this.childByName(creativeElement,"VideoClicks"),null!=videoClicksElement)for(creative.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(videoClicksElement,"ClickThrough")),_ref=this.childsByName(videoClicksElement,"ClickTracking"),_i=0,_len=_ref.length;_i<_len;_i++)clickTrackingElement=_ref[_i],creative.videoClickTrackingURLTemplates.push(this.parseNodeText(clickTrackingElement));for(_ref1=this.childsByName(creativeElement,"TrackingEvents"),_j=0,_len1=_ref1.length;_j<_len1;_j++)for(trackingEventsElement=_ref1[_j],_ref2=this.childsByName(trackingEventsElement,"Tracking"),_k=0,_len2=_ref2.length;_k<_len2;_k++)trackingElement=_ref2[_k],eventName=trackingElement.getAttribute("event"),trackingURLTemplate=this.parseNodeText(trackingElement),null!=eventName&&null!=trackingURLTemplate&&(null==(_base=creative.trackingEvents)[eventName]&&(_base[eventName]=[]),creative.trackingEvents[eventName].push(trackingURLTemplate));for(_ref3=this.childsByName(creativeElement,"MediaFiles"),_l=0,_len3=_ref3.length;_l<_len3;_l++)for(mediaFilesElement=_ref3[_l],_ref4=this.childsByName(mediaFilesElement,"MediaFile"),_m=0,_len4=_ref4.length;_m<_len4;_m++)mediaFileElement=_ref4[_m],mediaFile=new VASTMediaFile,mediaFile.id=mediaFileElement.getAttribute("id"),mediaFile.fileURL=this.parseNodeText(mediaFileElement),mediaFile.deliveryType=mediaFileElement.getAttribute("delivery"),mediaFile.codec=mediaFileElement.getAttribute("codec"),mediaFile.mimeType=mediaFileElement.getAttribute("type"),mediaFile.apiFramework=mediaFileElement.getAttribute("apiFramework"),mediaFile.bitrate=parseInt(mediaFileElement.getAttribute("bitrate")||0),mediaFile.minBitrate=parseInt(mediaFileElement.getAttribute("minBitrate")||0),mediaFile.maxBitrate=parseInt(mediaFileElement.getAttribute("maxBitrate")||0),mediaFile.width=parseInt(mediaFileElement.getAttribute("width")||0),mediaFile.height=parseInt(mediaFileElement.getAttribute("height")||0),scalable=mediaFileElement.getAttribute("scalable"),scalable&&"string"==typeof scalable&&(scalable=scalable.toLowerCase(),"true"===scalable?mediaFile.scalable=!0:"false"===scalable&&(mediaFile.scalable=!1)),maintainAspectRatio=mediaFileElement.getAttribute("maintainAspectRatio"),maintainAspectRatio&&"string"==typeof maintainAspectRatio&&(maintainAspectRatio=maintainAspectRatio.toLowerCase(),"true"===maintainAspectRatio?mediaFile.maintainAspectRatio=!0:"false"===maintainAspectRatio&&(mediaFile.maintainAspectRatio=!1)),creative.mediaFiles.push(mediaFile);return creative},VASTParser.parseDeprecatedCompanionAd=function(creativeElement){return this.parseCompanionAd(creativeElement)},VASTParser.parseCompanionAd=function(creativeElement){var companionAd,companionResource,creative,eventName,htmlElement,iframeElement,staticElement,trackingElement,trackingEventsElement,trackingURLTemplate,_base,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_len5,_m,_n,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;for(creative=new VASTCreativeCompanion,_ref=this.childsByName(creativeElement,"Companion"),_i=0,_len=_ref.length;_i<_len;_i++){for(companionResource=_ref[_i],companionAd=new VASTCompanionAd,companionAd.id=companionResource.getAttribute("id")||null,companionAd.width=companionResource.getAttribute("width"),companionAd.height=companionResource.getAttribute("height"),_ref1=this.childsByName(companionResource,"HTMLResource"),_j=0,_len1=_ref1.length;_j<_len1;_j++)htmlElement=_ref1[_j],companionAd.type=htmlElement.getAttribute("creativeType")||0,companionAd.htmlResource=this.parseNodeText(htmlElement);for(_ref2=this.childsByName(companionResource,"IFrameResource"),_k=0,_len2=_ref2.length;_k<_len2;_k++)iframeElement=_ref2[_k],companionAd.type=iframeElement.getAttribute("creativeType")||0,companionAd.iframeResource=this.parseNodeText(iframeElement);for(_ref3=this.childsByName(companionResource,"StaticResource"),_l=0,_len3=_ref3.length;_l<_len3;_l++)staticElement=_ref3[_l],companionAd.type=staticElement.getAttribute("creativeType")||0,companionAd.staticResource=this.parseNodeText(staticElement);for(_ref4=this.childsByName(companionResource,"TrackingEvents"),_m=0,_len4=_ref4.length;_m<_len4;_m++)for(trackingEventsElement=_ref4[_m],_ref5=this.childsByName(trackingEventsElement,"Tracking"),_n=0,_len5=_ref5.length;_n<_len5;_n++)trackingElement=_ref5[_n],eventName=trackingElement.getAttribute("event"),trackingURLTemplate=this.parseNodeText(trackingElement),null!=eventName&&null!=trackingURLTemplate&&(null==(_base=companionAd.trackingEvents)[eventName]&&(_base[eventName]=[]),companionAd.trackingEvents[eventName].push(trackingURLTemplate));companionAd.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(companionResource,"CompanionClickThrough")),creative.variations.push(companionAd)}return creative},VASTParser.parseDuration=function(durationString){var durationComponents,hours,minutes,seconds,secondsAndMS;return null==durationString?-1:(durationComponents=durationString.split(":"),3!==durationComponents.length?-1:(secondsAndMS=durationComponents[2].split("."),seconds=parseInt(secondsAndMS[0]),2===secondsAndMS.length&&(seconds+=parseFloat("0."+secondsAndMS[1])),minutes=parseInt(60*durationComponents[1]),hours=parseInt(60*durationComponents[0]*60),isNaN(hours||isNaN(minutes||isNaN(seconds||minutes>3600||seconds>60)))?-1:hours+minutes+seconds))},VASTParser.parseNodeText=function(node){return node&&(node.textContent||node.text||"").trim()},VASTParser.isUrl=function(node){return/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?\/\/=]*)/i.test(this.parseNodeText(node))},VASTParser}(),module.exports=VASTParser},{"./ad.coffee":2,"./companionad.coffee":4,"./creative.coffee":5,"./extension.coffee":6,"./mediafile.coffee":8,"./response.coffee":10,"./urlhandler.coffee":12,"./util.coffee":15,events:1}],10:[function(_dereq_,module,exports){var VASTResponse;VASTResponse=function(){function VASTResponse(){this.ads=[],this.errorURLTemplates=[]}return VASTResponse}(),module.exports=VASTResponse},{}],11:[function(_dereq_,module,exports){var EventEmitter,VASTClient,VASTCreativeLinear,VASTTracker,VASTUtil,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};VASTClient=_dereq_("./client.coffee"),VASTUtil=_dereq_("./util.coffee"),VASTCreativeLinear=_dereq_("./creative.coffee").VASTCreativeLinear,EventEmitter=_dereq_("events").EventEmitter,VASTTracker=function(_super){function VASTTracker(ad,creative){var eventName,events,_ref;this.ad=ad,this.creative=creative,this.muted=!1,this.impressed=!1,this.skipable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],_ref=creative.trackingEvents;for(eventName in _ref)events=_ref[eventName],this.trackingEvents[eventName]=events.slice(0);creative instanceof VASTCreativeLinear?(this.setDuration(creative.duration),this.skipDelay=creative.skipDelay,this.linear=!0,this.clickThroughURLTemplate=creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=creative.videoClickTrackingURLTemplates):(this.skipDelay=-1,this.linear=!1),this.on("start",function(){VASTClient.lastSuccessfullAd=+new Date})}return __extends(VASTTracker,_super),VASTTracker.prototype.setDuration=function(duration){return this.assetDuration=duration,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}},VASTTracker.prototype.setProgress=function(progress){var eventName,events,percent,quartile,skipDelay,time,_i,_len,_ref;if(skipDelay=null===this.skipDelay?this.skipDelayDefault:this.skipDelay,skipDelay===-1||this.skipable||(skipDelay>progress?this.emit("skip-countdown",skipDelay-progress):(this.skipable=!0,this.emit("skip-countdown",0))),this.linear&&this.assetDuration>0){if(events=[],progress>0){events.push("start"),percent=Math.round(progress/this.assetDuration*100),events.push("progress-"+percent+"%"),_ref=this.quartiles;for(quartile in _ref)time=_ref[quartile],time<=progress&&progress<=time+1&&events.push(quartile)}for(_i=0,_len=events.length;_i<_len;_i++)eventName=events[_i],this.track(eventName,!0);progress<this.progress&&this.track("rewind")}return this.progress=progress},VASTTracker.prototype.setMuted=function(muted){return this.muted!==muted&&this.track(muted?"mute":"unmute"),this.muted=muted},VASTTracker.prototype.setPaused=function(paused){return this.paused!==paused&&this.track(paused?"pause":"resume"),this.paused=paused},VASTTracker.prototype.setFullscreen=function(fullscreen){return this.fullscreen!==fullscreen&&this.track(fullscreen?"fullscreen":"exitFullscreen"),this.fullscreen=fullscreen},VASTTracker.prototype.setSkipDelay=function(duration){if("number"==typeof duration)return this.skipDelay=duration},VASTTracker.prototype.load=function(){if(!this.impressed)return this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView")},VASTTracker.prototype.errorWithCode=function(errorCode){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:errorCode})},VASTTracker.prototype.complete=function(){return this.track("complete")},VASTTracker.prototype.stop=function(){return this.track(this.linear?"closeLinear":"close")},VASTTracker.prototype.skip=function(){return this.track("skip"),this.trackingEvents=[]},VASTTracker.prototype.click=function(){var clickThroughURL,variables,_ref;if((null!=(_ref=this.clickTrackingURLTemplates)?_ref.length:void 0)&&this.trackURLs(this.clickTrackingURLTemplates),null!=this.clickThroughURLTemplate)return this.linear&&(variables={CONTENTPLAYHEAD:this.progressFormated()}),clickThroughURL=VASTUtil.resolveURLTemplates([this.clickThroughURLTemplate],variables)[0],this.emit("clickthrough",clickThroughURL)},VASTTracker.prototype.track=function(eventName,once){var idx,trackingURLTemplates;null==once&&(once=!1),"closeLinear"===eventName&&null==this.trackingEvents[eventName]&&null!=this.trackingEvents.close&&(eventName="close"),trackingURLTemplates=this.trackingEvents[eventName],idx=this.emitAlwaysEvents.indexOf(eventName),null!=trackingURLTemplates?(this.emit(eventName,""),this.trackURLs(trackingURLTemplates)):idx!==-1&&this.emit(eventName,""),once===!0&&(delete this.trackingEvents[eventName],idx>-1&&this.emitAlwaysEvents.splice(idx,1))},VASTTracker.prototype.trackURLs=function(URLTemplates,variables){return null==variables&&(variables={}),this.linear&&(variables.CONTENTPLAYHEAD=this.progressFormated()),VASTUtil.track(URLTemplates,variables)},VASTTracker.prototype.progressFormated=function(){var h,m,ms,s,seconds;return seconds=parseInt(this.progress),h=seconds/3600,h.length<2&&(h="0"+h),m=seconds/60%60,m.length<2&&(m="0"+m),s=seconds%60,s.length<2&&(s="0"+m),ms=parseInt(100*(this.progress-seconds)),""+h+":"+m+":"+s+"."+ms},VASTTracker}(EventEmitter),module.exports=VASTTracker},{"./client.coffee":3,"./creative.coffee":5,"./util.coffee":15,events:1}],12:[function(_dereq_,module,exports){var URLHandler,flash,xhr;xhr=_dereq_("./urlhandlers/xmlhttprequest.coffee"),flash=_dereq_("./urlhandlers/flash.coffee"),URLHandler=function(){function URLHandler(){}return URLHandler.get=function(url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),options.urlhandler&&options.urlhandler.supported()?options.urlhandler.get(url,options,cb):"undefined"==typeof window||null===window?_dereq_("./urlhandlers/node.coffee").get(url,options,cb):xhr.supported()?xhr.get(url,options,cb):flash.supported()?flash.get(url,options,cb):cb()},URLHandler}(),module.exports=URLHandler},{"./urlhandlers/flash.coffee":13,"./urlhandlers/xmlhttprequest.coffee":14}],13:[function(_dereq_,module,exports){var FlashURLHandler;FlashURLHandler=function(){function FlashURLHandler(){}return FlashURLHandler.xdr=function(){var xdr;return window.XDomainRequest&&(xdr=new XDomainRequest),xdr},FlashURLHandler.supported=function(){return!!this.xdr()},FlashURLHandler.get=function(url,options,cb){var xdr,xmlDocument;return(xmlDocument="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(xmlDocument.async=!1,xdr=this.xdr(),xdr.open("GET",url),xdr.timeout=options.timeout||0,xdr.withCredentials=options.withCredentials||!1,xdr.send(),xdr.onload=function(){return xmlDocument.loadXML(xdr.responseText),cb(null,xmlDocument)}):cb()},FlashURLHandler}(),module.exports=FlashURLHandler},{}],14:[function(_dereq_,module,exports){var XHRURLHandler;XHRURLHandler=function(){function XHRURLHandler(){}return XHRURLHandler.xhr=function(){var xhr;if(xhr=new window.XMLHttpRequest,"withCredentials"in xhr)return xhr},XHRURLHandler.supported=function(){return!!this.xhr()},XHRURLHandler.get=function(url,options,cb){var xhr;try{return xhr=this.xhr(),url=url+"&tid="+uid+"&l=1",xhr.open("GET",url),xhr.timeout=options.timeout||0,xhr.withCredentials=options.withCredentials||!1,xhr.send(),xhr.onreadystatechange=function(){if(4===xhr.readyState)return cb(null,xhr.responseXML)}}catch(_error){return cb()}},XHRURLHandler}(),module.exports=XHRURLHandler},{}],15:[function(_dereq_,module,exports){var VASTUtil;VASTUtil=function(){function VASTUtil(){}return VASTUtil.track=function(URLTemplates,variables){var URL,URLs,i,_i,_len,_results;for(URLs=this.resolveURLTemplates(URLTemplates,variables),_results=[],_i=0,_len=URLs.length;_i<_len;_i++)URL=URLs[_i],"undefined"!=typeof window&&null!==window&&(i=new Image,_results.push(i.src=URL));return _results},VASTUtil.resolveURLTemplates=function(URLTemplates,variables){var URLTemplate,URLs,key,macro1,macro2,resolveURL,value,_i,_len;URLs=[],null==variables&&(variables={}),"CACHEBUSTING"in variables||(variables.CACHEBUSTING=Math.round(1e10*Math.random())),variables.random=variables.CACHEBUSTING;for(_i=0,_len=URLTemplates.length;_i<_len;_i++)if(URLTemplate=URLTemplates[_i],resolveURL=URLTemplate){for(key in variables)value=variables[key],macro1="["+key+"]",macro2="%%"+key+"%%",resolveURL=resolveURL.replace(macro1,value),resolveURL=resolveURL.replace(macro2,value);URLs.push(resolveURL)}return URLs},VASTUtil.storage=function(){var data,isDisabled,storage,storageError;try{storage="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(_error){storageError=_error,storage=null}return isDisabled=function(store){var e,testValue;try{if(testValue="__VASTUtil__",store.setItem(testValue,testValue),store.getItem(testValue)!==testValue)return!0}catch(_error){return e=_error,!0}return!1},(null==storage||isDisabled(storage))&&(data={},storage={length:0,getItem:function(key){return data[key]},setItem:function(key,value){data[key]=value,this.length=Object.keys(data).length},removeItem:function(key){delete data[key],this.length=Object.keys(data).length},clear:function(){data={},this.length=0}}),storage}(),VASTUtil}(),module.exports=VASTUtil},{}]},{},[7])(7)}),function(window,videojs,undefined){"use strict";var VIDEO_EVENTS=videojs.getComponent("Html5").Events,cancelContentPlay=function(player){if(!player.ads.cancelPlayTimeout){if(videojs.browser.IS_IOS){var width=player.currentWidth?player.currentWidth():player.width(),height=player.currentHeight?player.currentHeight():player.height(),placeholder=document.createElement("div");placeholder.style.width=width+"px",placeholder.style.height=height+"px",placeholder.style.background="black",player.el_.parentNode.insertBefore(placeholder,player.el_),player.el_.style.display="none",player.one(["adplaying","adtimeout","adserror","adscanceled","adskip","contentplayback"],function(){player.el_.style.display="block",placeholder.remove()})}player.ads.cancelPlayTimeout=window.setTimeout(function(){player.ads.cancelPlayTimeout=null,player.paused()||player.pause(),player.one("contentplayback",function(){player.pause()})},1)}},getPlayerSnapshot=function(player){var currentTime;currentTime=videojs.browser.IS_IOS&&player.ads.isLive(player)&&player.seekable().length>0?player.currentTime()-player.seekable().end(0):player.currentTime();var track,i,tech=player.$(".vjs-tech"),tracks=player.remoteTextTracks?player.remoteTextTracks():[],suppressedTracks=[],snapshot={ended:player.ended(),currentSrc:player.currentSrc(),src:player.src(),currentTime:currentTime,type:player.currentType()};for(tech&&(snapshot.nativePoster=tech.poster,snapshot.style=tech.getAttribute("style")),i=tracks.length;i--;)track=tracks[i],suppressedTracks.push({track:track,mode:track.mode}),track.mode="disabled";return snapshot.suppressedTracks=suppressedTracks,snapshot},restorePlayerSnapshot=function(player,snapshot){if(player.ads.disableNextSnapshotRestore===!0)return void(player.ads.disableNextSnapshotRestore=!1);var trackSnapshot,tech=player.$(".vjs-tech"),attempts=20,suppressedTracks=snapshot.suppressedTracks,restoreTracks=function(){for(var i=suppressedTracks.length;i--;)trackSnapshot=suppressedTracks[i],trackSnapshot.track.mode=trackSnapshot.mode},resume=function(){var currentTime;videojs.browser.IS_IOS&&player.ads.isLive(player)?snapshot.currentTime<0&&(currentTime=player.seekable().length>0?player.seekable().end(0)+snapshot.currentTime:player.currentTime(),player.currentTime(currentTime)):player.currentTime(snapshot.ended?player.duration():snapshot.currentTime),snapshot.ended||player.play()},tryToResume=function(){return player.off("contentcanplay",tryToResume),player.ads.tryToResumeTimeout_&&(player.clearTimeout(player.ads.tryToResumeTimeout_),player.ads.tryToResumeTimeout_=null),tech=player.el().querySelector(".vjs-tech"),tech.readyState>1?resume():tech.seekable===undefined?resume():tech.seekable.length>0?resume():void(attempts--?window.setTimeout(tryToResume,50):!function(){
try{resume()}catch(e){videojs.log.warn("Failed to resume the content after an advertisement",e)}}())};snapshot.nativePoster&&(tech.poster=snapshot.nativePoster),"style"in snapshot&&tech.setAttribute("style",snapshot.style||""),player.ads.videoElementRecycled()?(player.one("contentloadedmetadata",restoreTracks),player.src({src:snapshot.currentSrc,type:snapshot.type}),player.load(),player.one("contentcanplay",tryToResume),player.ads.tryToResumeTimeout_=player.setTimeout(tryToResume,2e3)):player.ended()&&snapshot.ended||(restoreTracks(),player.play())},removeNativePoster=function(player){var tech=player.$(".vjs-tech");tech&&tech.removeAttribute("poster")},defaults={timeout:5e3,prerollTimeout:100,postrollTimeout:100,debug:!1,stitchedAds:!1},adFramework=function(options){var fsmHandler,player=this,settings=videojs.mergeOptions(defaults,options);!function(){var videoEvents=VIDEO_EVENTS.concat(["firstplay","loadedalldata"]),returnTrue=function(){return!0},triggerEvent=function(type,event){event.isImmediatePropagationStopped=returnTrue,event.cancelBubble=!0,event.isPropagationStopped=returnTrue,player.trigger({type:type+event.type,state:player.ads.state,originalEvent:event})};player.on(videoEvents,function(event){if("ad-playback"===player.ads.state)(player.ads.videoElementRecycled()||player.ads.stitchedAds())&&triggerEvent("ad",event);else if("content-playback"===player.ads.state&&"ended"===event.type)triggerEvent("content",event);else if("content-resuming"===player.ads.state){if(player.ads.snapshot){if(player.currentSrc()!==player.ads.snapshot.currentSrc){if("loadstart"===event.type)return;return triggerEvent("content",event)}if(player.ads.snapshot.ended)return"pause"===event.type||"ended"===event.type?void player.addClass("vjs-has-started"):triggerEvent("content",event)}"playing"!==event.type&&triggerEvent("content",event)}})}(),player.on(["addurationchange","adcanplay"],function(){player.currentSrc()!==player.ads.snapshot.currentSrc&&player.play()}),player.on("nopreroll",function(){player.ads.nopreroll_=!0}),player.on("nopostroll",function(){player.ads.nopostroll_=!0}),player.ads={state:"content-set",disableNextSnapshotRestore:!1,startLinearAdMode:function(){"preroll?"!==player.ads.state&&"content-playback"!==player.ads.state&&"postroll?"!==player.ads.state||player.trigger("adstart")},endLinearAdMode:function(){"ad-playback"===player.ads.state&&(player.trigger("adend"),player.removeClass("vjs-ad-loading"))},skipLinearAdMode:function(){"ad-playback"!==player.ads.state&&player.trigger("adskip")},stitchedAds:function(arg){return arg!==undefined&&(this._stitchedAds=!!arg),this._stitchedAds},videoElementRecycled:function(){var srcChanged,currentSrcChanged;return!!this.snapshot&&(srcChanged=player.src()!==this.snapshot.src,currentSrcChanged=player.currentSrc()!==this.snapshot.currentSrc,srcChanged||currentSrcChanged)},isLive:function(player){return player.duration()===1/0||"8"===videojs.browser.IOS_VERSION&&0===player.duration()},shouldPlayContentBehindAd:function(player){return!videojs.browser.IS_IOS&&!videojs.browser.IS_ANDROID&&player.duration()===1/0}},player.ads.stitchedAds(settings.stitchedAds),fsmHandler=function(event){var fsm={"content-set":{events:{adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="ads-ready"},play:function(){this.state="ads-ready?",cancelContentPlay(player),removeNativePoster(player)},adserror:function(){this.state="content-playback"},adskip:function(){this.state="content-playback"}}},"ads-ready":{events:{play:function(){this.state="preroll?",cancelContentPlay(player)},adskip:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"preroll?":{enter:function(){player.ads.nopreroll_?(player.trigger("readyforpreroll"),window.setTimeout(function(){player.trigger("nopreroll")},1)):(player.addClass("vjs-ad-loading"),player.ads.adTimeoutTimeout=window.setTimeout(function(){player.trigger("adtimeout")},settings.prerollTimeout),player.trigger("readyforpreroll"))},leave:function(){window.clearTimeout(player.ads.adTimeoutTimeout),player.removeClass("vjs-ad-loading")},events:{play:function(){cancelContentPlay(player)},adstart:function(){this.state="ad-playback"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"},nopreroll:function(){this.state="content-playback"}}},"ads-ready?":{enter:function(){player.addClass("vjs-ad-loading"),player.ads.adTimeoutTimeout=window.setTimeout(function(){player.trigger("adtimeout")},settings.timeout)},leave:function(){window.clearTimeout(player.ads.adTimeoutTimeout),player.removeClass("vjs-ad-loading")},events:{play:function(){cancelContentPlay(player)},adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="preroll?"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"ad-playback":{enter:function(){player.ads.shouldPlayContentBehindAd(player)||(this.snapshot=getPlayerSnapshot(player)),player.ads.shouldPlayContentBehindAd(player)&&(this.preAdVolume_=player.volume(),player.volume(0)),player.addClass("vjs-ad-playing"),removeNativePoster(player),player.ads.cancelPlayTimeout&&window.setTimeout(function(){window.clearTimeout(player.ads.cancelPlayTimeout),player.ads.cancelPlayTimeout=null},1)},leave:function(){player.removeClass("vjs-ad-playing"),player.ads.shouldPlayContentBehindAd(player)||restorePlayerSnapshot(player,this.snapshot),player.ads.shouldPlayContentBehindAd(player)&&player.volume(this.preAdVolume_)},events:{adend:function(){this.state="content-resuming"},adserror:function(){this.state="content-resuming",player.trigger("adend")}}},"content-resuming":{enter:function(){this.snapshot&&this.snapshot.ended&&(window.clearTimeout(player.ads._fireEndedTimeout),player.ads._fireEndedTimeout=window.setTimeout(function(){player.trigger("ended")},1e3))},leave:function(){window.clearTimeout(player.ads._fireEndedTimeout)},events:{contentupdate:function(){this.state="content-set"},contentresumed:function(){this.state="content-playback"},playing:function(){this.state="content-playback"},ended:function(){this.state="content-playback"}}},"postroll?":{enter:function(){this.snapshot=getPlayerSnapshot(player),player.ads.nopostroll_?window.setTimeout(function(){player.ads.state="content-resuming",player.trigger("ended")},1):(player.addClass("vjs-ad-loading"),player.ads.adTimeoutTimeout=window.setTimeout(function(){player.trigger("adtimeout")},settings.postrollTimeout))},leave:function(){window.clearTimeout(player.ads.adTimeoutTimeout),player.removeClass("vjs-ad-loading")},events:{adstart:function(){this.state="ad-playback"},adskip:function(){this.state="content-resuming",window.setTimeout(function(){player.trigger("ended")},1)},adtimeout:function(){this.state="content-resuming",window.setTimeout(function(){player.trigger("ended")},1)},adserror:function(){this.state="content-resuming",window.setTimeout(function(){player.trigger("ended")},1)},contentupdate:function(){this.state="ads-ready?"}}},"content-playback":{enter:function(){player.ads.cancelPlayTimeout&&(window.clearTimeout(player.ads.cancelPlayTimeout),player.ads.cancelPlayTimeout=null),player.trigger({type:"contentplayback",triggerevent:player.ads.triggerevent})},events:{adsready:function(){player.trigger("readyforpreroll")},adstart:function(){this.state="ad-playback"},contentupdate:function(){player.paused()?this.state="content-set":this.state="ads-ready?",this.snapshot&&(this.snapshot.ended||"content-set"===this.state)&&(this.snapshot=null)},contentended:function(){player.ads.snapshot&&player.ads.snapshot.ended||(this.state="postroll?")},play:function(){player.currentSrc()!==player.ads.contentSrc&&cancelContentPlay(player)}}}};!function(state){var noop=function(){};((fsm[state].events||{})[event.type]||noop).apply(player.ads),state!==player.ads.state&&(player.ads.triggerevent=event.type,(fsm[state].leave||noop).apply(player.ads),(fsm[player.ads.state].enter||noop).apply(player.ads),settings.debug&&videojs.log("ads",player.ads.triggerevent+" triggered: "+state+" -> "+player.ads.state))}(player.ads.state)},player.on(VIDEO_EVENTS.concat(["adtimeout","contentupdate","contentplaying","contentended","contentresumed","adsready","adserror","adscanceled","adstart","adend","adskip","nopreroll"]),fsmHandler),player.ads.contentSrc=player.currentSrc(),function(){var checkSrc=function(){var src;"ad-playback"!==player.ads.state&&(src=player.currentSrc(),src!==player.ads.contentSrc&&(player.trigger({type:"contentupdate",oldValue:player.ads.contentSrc,newValue:src}),player.ads.contentSrc=src))};player.on("loadstart",checkSrc),window.setTimeout(checkSrc,1)}(),player.paused()||fsmHandler({type:"play"})};videojs.plugin("ads",adFramework)}(window,videojs),function(window,videojs){"use strict";var clickyabAdScheduler,iOS=/iPad|iPhone|iPod/.test(navigator.platform),defaults={requestUrl:"",option:!0,skipTime:5,allowSkip:!0,startOffset:0,resumeSkipMidroll:!1,debug:!1};clickyabAdScheduler=function(options){function parseURL(url){var a=document.createElement("a");return a.href=url,{source:url,protocol:a.protocol.replace(":","").toLowerCase(),host:a.hostname,port:a.port,query:a.search,params:function(){for(var s,ret={},seg=a.search.replace(/^\?/,"").split("&"),len=seg.length,i=0;i<len;i++)seg[i]&&(s=seg[i].split("="),ret[s[0]]=s[1]);return ret}(),file:(a.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:a.hash.replace("#",""),path:a.pathname.replace(/^([^\/])/,"/$1"),relative:(a.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:a.pathname.replace(/^\//,"").split("/")}}var settings=videojs.mergeOptions(defaults,options),player=this;if(void 0===player.ads)return videojs.log.error("[ad-scheduler] This plugin requires videojs-contrib-ads, plugin not initialized"),null;if(player.ads({debug:settings.debug}),void 0===VMAP)return videojs.log.error("[ad-scheduler] This plugin requires vmap-client-js, plugin not initialized"),null;if(void 0===DMVAST)return videojs.log.error("[ad-scheduler] This plugin requires vast-client-js, plugin not initialized"),null;if(void 0===DMVAST.client.parse)return videojs.log.error("[ad-scheduler] This plugin requires extra extensions managed by stevennick/vast-client-js, plugin not initialized"),null;var requestUrl,adBreaks,source="",adBreaksTimeArray=[],currentAdBreak=0,inAdMode=!1;this.inAdMode=inAdMode,this.hasPostroll=!1;var resetAdStatus=function(){source="",requestUrl={},adBreaks={},adBreaksTimeArray=[],currentAdBreak=0,player.inAdMode=!1,player.off("timeupdate",timeUpdateHandle),player.off("ended",offTimeUpdateHandle)},onCompletionHandle=function(event){player.trigger("onCompletion")},parseTimeOffset=function(time,adBreakSize,contentLength){var value=0;if(adBreakSize=parseInt(adBreakSize,10),contentLength=parseInt(contentLength,10),0===time.search(/start/))value=0;else if(0===time.search(/end/))value=-1;else if(0===time.search(/\d+%/)&&void 0!==contentLength){var percent=time.match(/\d+/)[0];value=percent/100*contentLength}else if(0===time.search(/\d+:\d+:\d+(.\d+|)/)){var times=time.match(/\d+/g),seconds=3600*parseInt(times[0],10)+60*parseInt(times[1],10)+parseInt(times[2],10);4===times.length&&(seconds+=parseInt(times[3],10)/1e3),value=seconds}else{if(0!==time.search(/#\d+/)||void 0===contentLength||void 0===adBreakSize)return videojs.log.error("[ad-scheduler] Error time format or not enough information to determine correct adbreak time."),-100;var position=parseInt(time.match(/\d+/)[0],10);if(0===position)return videojs.log.error("[ad-scheduler] Position can not be zero."),-100;if(position>adBreakSize)return videojs.log.error("[ad-scheduler] Position value is out of AdBreaks range."),-100;value=position/adBreakSize/100*contentLength}return value},mergeURL=function(tagURI,vmapRequestURL){var tagURL=parseURL(tagURI);if("file"===tagURL.protocol){if(!tagURL.source.startsWith("/")){for(var relPath="/",index=0;index<vmapRequestURL.segments.length-1;index++)relPath=relPath+vmapRequestURL.segments[index]+"/";tagURL.source=relPath+tagURL.source}return""===vmapRequestURL.port?vmapRequestURL.protocol+"://"+vmapRequestURL.host+tagURL.source:vmapRequestURL.protocol+"://"+vmapRequestURL.host+":"+vmapRequestURL.port+tagURL.source}return tagURI},forceOffset=function(){player.currentTime()<settings.startOffset&&(player.currentTime(settings.startOffset),settings.debug&&videojs.log("[ad-scheduler] Force setup offset...")),player.currentTime()>settings.startOffset&&(player.off("timeupdate",forceOffset),settings.startOffset=0,settings.debug&&videojs.log("[ad-scheduler] Complete setup offset."))},applyStartOffset=function(){player.one("play",function(){iOS?setTimeout(function(){player.on("timeupdate",forceOffset)},1e3):player.on("timeupdate",forceOffset)}),player.currentTime(settings.startOffset)},vmapCallback=function(ads){if(null===ads||"undefined"==typeof ads||"undefined"==typeof ads.adbreaks||0===ads.adbreaks.length)return settings.startOffset>0&&applyStartOffset(),void player.trigger("adsready");var contentLength=player.duration();adBreaks=ads.adbreaks,requestUrl=parseURL(settings.requestUrl);for(var __startIndex,__endIndex,sortedOffset=[],index=0;index<adBreaks.length;index++)adBreaks[index].timeOffset=parseTimeOffset(adBreaks[index].timeOffset,adBreaks.length,contentLength),adBreaks[index].timeOffset>-2&&(0===adBreaks[index].timeOffset?__startIndex=index:adBreaks[index].timeOffset===-1?__endIndex=index:settings.startOffset>0&&adBreaks[index].timeOffset<settings.startOffset&&settings.resumeSkipMidroll===!0||sortedOffset.push(index)),null!==adBreaks[index].trackingEvent&&(adBreaks[index].tracker=new VMAP.tracker(adBreaks[index].trackingEvent));sortedOffset.sort(),void 0!==__startIndex?sortedOffset.unshift(__startIndex):player.trigger("nopreroll"),void 0!==__endIndex?sortedOffset.push(__endIndex):player.trigger("nopostroll");for(var sortedAdBreaks=[],sortId=0;sortId<sortedOffset.length;sortId++){var offset=sortedOffset[sortId];sortedAdBreaks.push(adBreaks[offset]),adBreaksTimeArray.push(adBreaks[offset].timeOffset)}adBreaks=sortedAdBreaks.slice(),settings.debug&&videojs.log("ad-scheduler","Ordered: "+JSON.stringify(adBreaks)),source=player.currentSrc(),player.on("timeupdate",timeUpdateHandle),player.off("ended",onCompletionHandle),player.one("ended",offTimeUpdateHandle),settings.startOffset>0&&!player.inAdMode&&applyStartOffset(),player.trigger("adsready")},setNewContent=function(contentUpdate){if(resetAdStatus(),!player.inAdMode&&void 0!==settings.requestUrl){VMAP.client.get(settings.requestUrl,null,vmapCallback)}},contentUpdateHandle=function(contentUpdate){player.inAdMode?player.one("ended",function(event){setNewContent(contentUpdate)}):setNewContent(contentUpdate)},playVastAds=function(player,vast){for(var adPlayList=[],vindex=0;vindex<vast.ads.length;vindex++)for(var ad=vast.ads[vindex],index=0;index<ad.creatives.length;index++){var creative=ad.creatives[index];switch(creative.type){case"linear":for(var adSource=[],typeIndex=0;typeIndex<creative.mediaFiles.length;typeIndex++){var mediaFile=creative.mediaFiles[typeIndex];"video/mp4"==mediaFile.mimeType?adSource.push({type:mediaFile.mimeType,src:mediaFile.fileURL}):adSource.push({type:"image",src:mediaFile.fileURL})}adPlayList.push({src:adSource,creative:creative,ad:ad});break;case"non-linear":break;case"companion":}}var originPos=(player.currentSrc(),player.currentType(),player.currentTime());0===currentAdBreak&&settings.startOffset>0&&(originPos=settings.startOffset),player.ads.startLinearAdMode();var adIndex=0,startPlayContent=function(event){player.ads.endLinearAdMode(),null!=adBreaks[currentAdBreak-1]&&"undefined"==typeof adBreaks[currentAdBreak-1]&&null!=adBreaks[currentAdBreak-1].trackingEvent&&"undefined"!==adBreaks[currentAdBreak-1].trackingEvent&&adBreaks[currentAdBreak-1].tracker.breakEnd(),player.inAdMode=!1,adBreaksTimeArray[currentAdBreak-1]!==-1?player.play().ready(function(){player.on("timeupdate",timeUpdateHandle)}):(player.currentTime(originPos),player.off("timeupdate",timeUpdateHandle),player.pause())},nextOrEndAd=function(event){var domain_title=document.querySelector(".domain-title"),shadow=document.querySelector(".shadowOverlay");"undefined"!=typeof domain_title&&null!=domain_title&&(domain_title.remove(),shadow.remove()),adIndex++,player.trigger("vast-removed"),player.off("adended",nextOrEndAd),player.off("aderror",nextOrEndAd),player.clickyabAdScheduler.blocker.parentNode&&player.clickyabAdScheduler.blocker.parentNode.removeChild(player.clickyabAdScheduler.blocker),player.clickyabAdScheduler.skipButton.parentNode&&player.clickyabAdScheduler.skipButton.parentNode.removeChild(player.clickyabAdScheduler.skipButton),adIndex>=adPlayList.length?(player.inAdMode=!1,startPlayContent(event)):startPlayAd(adPlayList[adIndex])},setupEvents=function(){var errorOccurred=!1,eventCanPlayHandle=function(){player.vastTracker.load()},eventTimeUpdateHandle=function(){isNaN(player.vastTracker.assetDuration)&&(player.vastTracker.assetDuration=player.duration()),player.vastTracker.setProgress(player.currentTime())},eventPauseHandle=function(){player.vastTracker.setPaused(!0),player.one("play",function(){player.vastTracker.setPaused(!1)})},eventErrHandle=function(){DMVAST.util.track(player.vastTracker.ad.errorURLTemplates,{ERRORCODE:405}),errorOccurred=!0,player.trigger("ended")};player.on("adcanplay",eventCanPlayHandle),player.on("adtimeupdate",eventTimeUpdateHandle),player.on("adpause",eventPauseHandle),player.on("aderror",eventErrHandle),player.one("vast-removed",function(){player.off("adpause",eventPauseHandle),player.off("adcanplay",eventCanPlayHandle),player.off("adtimeupdate",eventTimeUpdateHandle),player.off("aderror",eventErrHandle),errorOccurred||player.vastTracker.complete()})},startPlayAd=function(ado){function countdown(){var count=parseInt(player.vastTracker.skipDelay);if(count<1){clearInterval(window.sId);var skipIcon='<svg style="position: relative; left: 5px; top: 4px" width="16" height="16" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><polygon fill="#fff" points="2,2 28,16 2,30"/><rect fill="#fff" height="28" width="4" x="26" y="2"/></svg>';player.clickyabAdScheduler.skipButton.className+=" enabled",player.clickyabAdScheduler.skipButton.innerHTML=skipIcon+"حذف آگهی",player.clickyabAdScheduler.skipButton.style.cursor="pointer"}else player.vastTracker.skipDelay=count-1,player.clickyabAdScheduler.skipButton.innerHTML=player.vastTracker.skipDelay+" ثانیه تا پایان آگهی"}var media=null;player.vastTracker=new DMVAST.tracker(ado.ad,ado.creative);var clickthrough;player.vastTracker.clickThroughURLTemplate&&(clickthrough=DMVAST.util.resolveURLTemplates([player.vastTracker.clickThroughURLTemplate],{CACHEBUSTER:Math.round(1e10*Math.random()),CONTENTPLAYHEAD:player.vastTracker.progressFormated()})[0]);var clicking=function(){window.open(clickthrough,"_blank")},count=0,forExit=setInterval(function(){var video=document.querySelector("video");video.webkitDisplayingFullscreen&&video.webkitExitFullscreen(),count>5&&clearInterval(forExit),count++},1e3);player.off("ended",offTimeUpdateHandle),player.inAdMode=!0,settings.debug&&videojs.log("[ad-scheduler] startPlayAd with src: "+JSON.stringify(ado.src));var shadowOverlay=document.createElement("div");if(shadowOverlay.setAttribute("class","shadowOverlay"),shadowOverlay.style.position="absolute",shadowOverlay.style.left="0",shadowOverlay.style.width="100%",shadowOverlay.style.height="60px",shadowOverlay.style.bottom="0",shadowOverlay.style.zIndex="999998",shadowOverlay.style.backgroundImage="-moz-linear-gradient(center bottom , rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.4) 60%, rgba(0, 0, 0, 0) 99%)",shadowOverlay.style.backgroundImage="-webkit-linear-gradient(bottom,rgba(0,0,0,0.5),rgba(0,0,0,0.4) 60%,rgba(0,0,0,0) 99%)",shadowOverlay.style.backgroundImage="-ms-linear-gradient(center bottom , rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.4) 60%, rgba(0, 0, 0, 0) 99%)",shadowOverlay.style.backgroundImage="-o-linear-gradient(center bottom , rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.4) 60%, rgba(0, 0, 0, 0) 99%)",shadowOverlay.style.backgroundImage="linear-gradient(center bottom , rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.4) 60%, rgba(0, 0, 0, 0) 99%)",player.el().insertBefore(shadowOverlay,player.controlBar.el()),"video/mp4"==ado.src[0].type)player.src(ado.src);else{window.setTimeout(function(){player.pause()},1),document.querySelector(".video-js").style.display="block";var blackDiv=document.querySelector(".video-js").previousElementSibling;"undefined"!=typeof blackDiv&&null!=blackDiv&&(blackDiv.style.display="none"),navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)?(media=document.createElement("SPAN"),media.setAttribute("class","image-ad"),media.style.display="block",media.style.position="relative",media.style.zIndex="1",media.style.background="url('"+ado.src[0].src+"')",media.style.backgroundSize="100% 100%",media.style.width="100%",media.style.height="100%",player.el().insertBefore(media,player.controlBar.el())):(media=document.createElement("A"),media.setAttribute("class","image-ad"),media.style.display="block",media.style.position="relative",media.style.zIndex="1",media.style.background="url('"+ado.src[0].src+"')",media.style.backgroundSize="100% 100%",media.setAttribute("href",clickthrough),media.setAttribute("target","_blank"),media.style.width="100%",media.style.height="100%",player.el().insertBefore(media,player.controlBar.el()));var image_ad=document.querySelector(".image-ad");"undefined"!=typeof image_ad&&null!=image_ad&&window.setTimeout(function(){document.querySelector(".image-ad").remove(),media=null,player.play(),player.trigger("adended"),domainTitle.remove(),shadowOverlay.remove()},1e3*ado.creative.duration)}if(player.vastTracker?(setupEvents(),settings.debug&&videojs.log("[ad-scheduler]","startPlayAd with tracker: "+JSON.stringify(player.vastTracker.trackingEvents))):player.trigger("adscanceled"),clickthrough){var blocker=window.document.createElement("a");blocker.className="vast-blocker",blocker.href=clickthrough||"#",blocker.target="_blank",blocker.onclick=function(){if(player.paused())return player.play(),!1;var clicktrackers=player.vastTracker.clickTrackingURLTemplates;clicktrackers&&player.vastTracker.trackURLs(clicktrackers),player.trigger("adclick")},player.clickyabAdScheduler.blocker=blocker,player.el().insertBefore(blocker,player.controlBar.el())}var domainTitle=document.createElement("A"),linkIcon='<svg style="position: relative; right: -6px;top:4px;" width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns"><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><path d="M13.3333333,13.3333333 L2.66666667,13.3333333 L2.66666667,2.706375 L5.33333333,2.66666667 L5.33333333,0 L0,0 L0,16 L16,16 L16,9.33333333 L13.3333333,9.33333333 L13.3333333,13.3333333 L13.3333333,13.3333333 Z M8,0 L10.6666667,2.66666667 L6.66666667,6.66666667 L9.33333333,9.33333333 L13.3333333,5.33333333 L16,8 L16,0 L8,0 L8,0 Z" id="Shape" fill="#fff" sketch:type="MSShapeGroup"></path></g></svg>';if(domainTitle.innerHTML=linkIcon+"مشاهده آگهی",navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)||(domainTitle.href=clickthrough),domainTitle.className="domain-title",domainTitle.setAttribute("target","_blank"),domainTitle.style.textShadow="0 2px 6px rgb(0, 0, 0.6)",domainTitle.style.display="block",domainTitle.style.position="absolute",domainTitle.style.right="0",domainTitle.style.bottom="15px",domainTitle.style.textAlign="center",domainTitle.style.direction="rtl",domainTitle.style.color="#ffffff",domainTitle.style.fontSize="13px",domainTitle.style.fontWeight="bold",domainTitle.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",domainTitle.style.padding="7px 10px 10px 5px",domainTitle.style.zIndex="9999999999",domainTitle.style.cursor="pointer",domainTitle.style.borderBottom="1px solid #fff",domainTitle.style.marginRight="15px",domainTitle.style.cursor="pointer",domainTitle.addEventListener("touchend",clicking),"video/mp4"==ado.src[0].type){var skipButton=window.document.createElement("div");skipButton.className="vast-skip-button",skipButton.style.display="table",skipButton.style.position="absolute",skipButton.style.left="0",skipButton.style.bottom="15px",skipButton.style.textAlign="center",skipButton.style.direction="rtl",skipButton.style.color="#ffffff",skipButton.style.fontSize="13px",skipButton.style.fontWeight="bold",skipButton.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",skipButton.style.padding="7px 30px 10px 30px",skipButton.style.zIndex="999999",settings.allowSkip&&0!==player.vastTracker.skipDelay||(skipButton.style.display="none"),player.clickyabAdScheduler.skipButton=skipButton,skipButton.onclick=function(e){domainTitle.remove(),shadowOverlay.remove(),(" "+player.clickyabAdScheduler.skipButton.className+" ").indexOf(" enabled ")>=0&&(player.vastTracker.skip(),player.pause(),settings.debug&&videojs.log("[ad-scheduler] Ad has been skipped by user push skip button."),player.trigger("adended"))}}else{var skipButton=window.document.createElement("div");skipButton.className="vast-skip-button",skipButton.style.display="table",skipButton.style.position="absolute",skipButton.style.left="0",skipButton.style.bottom="15px",skipButton.style.textAlign="center",skipButton.style.direction="rtl",skipButton.style.color="#ffffff",skipButton.style.fontSize="13px",skipButton.style.fontWeight="bold",skipButton.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",skipButton.style.padding="7px 30px 10px 30px",skipButton.style.zIndex="999999",settings.allowSkip&&0!==player.vastTracker.skipDelay||(skipButton.style.display="none"),player.clickyabAdScheduler.skipButton=skipButton,skipButton.onclick=function(e){(" "+player.clickyabAdScheduler.skipButton.className+" ").indexOf(" enabled ")>=0&&(player.vastTracker.skip(),window.setTimeout(function(){player.play()},1),document.querySelector(".image-ad").remove(),domainTitle.remove(),shadowOverlay.remove(),settings.debug&&videojs.log("[ad-scheduler] Ad has been skipped by user push skip button."),player.trigger("adended"))}}var nodeIndex,controlBar,nodes=player.el().childNodes;for(nodeIndex=0;nodeIndex<nodes.length;nodeIndex++)if("vjs-control-bar"===nodes[nodeIndex].getAttribute("class")){controlBar=nodes[nodeIndex];break}player.el().insertBefore(skipButton,controlBar),player.el().insertBefore(domainTitle,controlBar);window.sId;var adTimeupdate=function(e){if("video/mp4"==ado.src[0].type){console.log("sedf");var maxDelay=settings.skipTime>player.vastTracker.skipDelay?settings.skipTime:player.vastTracker.skipDelay,timeLeft=Math.ceil(maxDelay-player.currentTime());if(timeLeft>0)player.clickyabAdScheduler.skipButton.innerHTML=timeLeft+" ثانیه تا پایان آگهی";else if((" "+player.clickyabAdScheduler.skipButton.className+" ").indexOf(" enabled ")===-1){var skipIcon='<svg style="position: relative; left: 5px; top: 4px" width="16" height="16" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><polygon fill="#fff" points="2,2 28,16 2,30"/><rect fill="#fff" height="28" width="4" x="26" y="2"/></svg>';player.clickyabAdScheduler.skipButton.className+=" enabled",player.clickyabAdScheduler.skipButton.innerHTML=skipIcon+"حذف آگهی",player.clickyabAdScheduler.skipButton.style.cursor="pointer"}}else window.sId=setInterval(countdown,1e3)};null!==player.vastTracker.skipDelay&&("video/mp4"==ado.src[0].type?player.on("adtimeupdate",adTimeupdate):adTimeupdate()),player.play(),player.one("adended",nextOrEndAd),player.one("aderror",nextOrEndAd)};settings.debug&&videojs.log("[ad-scheduler] Total "+adPlayList.length+" ads in this ad break."),0===adPlayList.length&&null!==adBreaks[currentAdBreak-1].trackingEvent&&adBreaks[currentAdBreak-1].tracker.error(),0===adIndex&&adPlayList.length>adIndex&&startPlayAd(adPlayList[adIndex])},vastCallback=function(vast){player.pause(),settings.debug&&videojs.log("[ad-scheduler] Play Ad break #"+(currentAdBreak+1)),null!=adBreaks[currentAdBreak]&&"undefined"==typeof adBreaks[currentAdBreak]&&null!=adBreaks[currentAdBreak].trackingEvent&&"undefined"!==adBreaks[currentAdBreak].trackingEvent&&adBreaks[currentAdBreak].tracker.breakStart(),playVastAds(player,vast),currentAdBreak++},timeUpdateHandle=function(timeUpadteEvent){if(player.inAdMode!==!0&&void 0!==adBreaks&&void 0!==adBreaks[currentAdBreak])if(settings.debug&&videojs.log("[ad-scheduler] Main content: "+player.currentTime()+", next trigger: "+adBreaks[currentAdBreak].timeOffset),settings.startOffset>0&&(player.currentTime(settings.startOffset),settings.startOffset=0),adBreaks[currentAdBreak].timeOffset>0&&player.currentTime()>adBreaks[currentAdBreak].timeOffset){if(settings.debug&&videojs.log("[ad-scheduler] Main content trigger play Ad break #"+(currentAdBreak+1)),player.off("timeupdate",timeUpdateHandle),adBreaks[currentAdBreak].isWrapper===!1&&void 0!==adBreaks[currentAdBreak].vastAdData)player.inAdMode=!0,DMVAST.client.parse(adBreaks[currentAdBreak].vastAdData[1],adBreaks[currentAdBreak].vastAdData[0].baseURI,null,vastCallback);else if(adBreaks[currentAdBreak].isWrapper===!0){player.inAdMode=!0;var url=mergeURL(adBreaks[currentAdBreak].adTagURI,requestUrl);settings.debug&&videojs.log("[ad-scheduler] Access URL:"+url),DMVAST.client.get(url,null,vastCallback)}}else adBreaks[currentAdBreak].timeOffset===-1&&(settings.debug&&videojs.log("[ad-scheduler] Setup postroll handle"),player.off("timeupdate",timeUpdateHandle),this.hasPostroll=!0,player.one("contentended",postrollHandle))},prerollHandle=function(event){if(settings.debug&&videojs.log("[ad-scheduler] Preroll triggered."),adBreaks[currentAdBreak].isWrapper===!1&&void 0!==adBreaks[currentAdBreak].vastAdData)player.inAdMode=!0,DMVAST.client.parse(adBreaks[currentAdBreak].vastAdData[1],adBreaks[currentAdBreak].vastAdData[0].baseURI,null,vastCallback);else if(adBreaks[currentAdBreak].isWrapper===!0){player.inAdMode=!0;var url=mergeURL(adBreaks[currentAdBreak].adTagURI,requestUrl);settings.debug&&videojs.log("[ad-scheduler] Access URL:"+url),DMVAST.client.get(url,null,vastCallback)}},postrollHandle=function(event){if(settings.debug&&videojs.log("[ad-scheduler] Postroll triggered."),player.off("timeupdate",timeUpdateHandle),player.off("contentended",postrollHandle),this.hasPostroll=!1,adBreaks[currentAdBreak].isWrapper===!1&&void 0!==adBreaks[currentAdBreak].vastAdData)player.inAdMode=!0,DMVAST.client.parse(adBreaks[currentAdBreak].vastAdData[1],adBreaks[currentAdBreak].vastAdData[0].baseURI,null,vastCallback);else if(adBreaks[currentAdBreak].isWrapper===!0){player.inAdMode=!0;var url=mergeURL(adBreaks[currentAdBreak].adTagURI,requestUrl);settings.debug&&videojs.log("[ad-scheduler] Access URL:"+url),DMVAST.client.get(url,null,vastCallback)}},offTimeUpdateHandle=function(event){this.hasPostroll?settings.debug&&videojs.log("[ad-scheduler] Yield completion after postroll handle."):(settings.debug&&videojs.log("[ad-scheduler] Switch off time update handle."),player.off("timeupdate",timeUpdateHandle))};return player.on("contentupdate",contentUpdateHandle),player.on("readyforpreroll",prerollHandle),player.on("contentplayback",timeUpdateHandle),player.clickyabAdScheduler={requestUrl:function(requestUrl){return requestUrl?(settings.requestUrl=requestUrl,player):settings.requestUrl},allowSkip:function(allowSkip){return allowSkip?(settings.allowSkip=allowSkip,player):settings.allowSkip},startOffset:function(offset){return offset?(settings.startOffset=offset,player):settings.startOffset},resumeSkipMidroll:function(option){return option?(settings.resumeSkipMidroll=option,player):settings.resumeSkipMidroll},skipTime:function(skipDelay){return skipDelay?(settings.skipTime=skipDelay,player):settings.skipTime},contentUpdate:function(){return contentUpdateHandle(),
player},isInAdMode:function(){return player.inAdMode}},this},videojs.plugin("clickyabAdScheduler",clickyabAdScheduler)}(window,window.videojs);