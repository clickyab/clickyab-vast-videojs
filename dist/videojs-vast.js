!function(name,context,definition){"undefined"!=typeof module&&module.exports?module.exports=definition():"function"==typeof define&&define.amd?define(definition):context[name]=definition()}("Fingerprint",this,function(){"use strict";var Fingerprint=function(options){var nativeForEach,nativeMap;nativeForEach=Array.prototype.forEach,nativeMap=Array.prototype.map,this.each=function(obj,iterator,context){if(null!==obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++)if(iterator.call(context,obj[i],i,obj)==={})return}else for(var key in obj)if(obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj)==={})return},this.map=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(this.each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)}),results)},"object"==typeof options?(this.hasher=options.hasher,this.screen_resolution=options.screen_resolution,this.screen_orientation=options.screen_orientation,this.canvas=options.canvas,this.ie_activex=options.ie_activex):"function"==typeof options&&(this.hasher=options)};return Fingerprint.prototype={get:function(){var keys=[];if(keys.push(navigator.userAgent),keys.push(navigator.language),keys.push(screen.colorDepth),this.screen_resolution){var resolution=this.getScreenResolution();"undefined"!=typeof resolution&&keys.push(resolution.join("x"))}return keys.push((new Date).getTimezoneOffset()),keys.push(this.hasSessionStorage()),keys.push(this.hasLocalStorage()),keys.push(!!window.indexedDB),document.body?keys.push(typeof document.body.addBehavior):keys.push("undefined"),keys.push(typeof window.openDatabase),keys.push(navigator.cpuClass),keys.push(navigator.platform),keys.push(navigator.doNotTrack),keys.push(this.getPluginsString()),this.canvas&&this.isCanvasSupported()&&keys.push(this.getCanvasFingerprint()),this.hasher?this.hasher(keys.join("###"),31):this.murmurhash3_32_gc(keys.join("###"),31)},murmurhash3_32_gc:function(key,seed){var remainder,bytes,h1,h1b,c1,c2,k1,i;for(remainder=3&key.length,bytes=key.length-remainder,h1=seed,c1=3432918353,c2=461845907,i=0;i<bytes;)k1=255&key.charCodeAt(i)|(255&key.charCodeAt(++i))<<8|(255&key.charCodeAt(++i))<<16|(255&key.charCodeAt(++i))<<24,++i,k1=(65535&k1)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295,k1=k1<<15|k1>>>17,k1=(65535&k1)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295,h1^=k1,h1=h1<<13|h1>>>19,h1b=5*(65535&h1)+((5*(h1>>>16)&65535)<<16)&4294967295,h1=(65535&h1b)+27492+(((h1b>>>16)+58964&65535)<<16);switch(k1=0,remainder){case 3:k1^=(255&key.charCodeAt(i+2))<<16;case 2:k1^=(255&key.charCodeAt(i+1))<<8;case 1:k1^=255&key.charCodeAt(i),k1=(65535&k1)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295,k1=k1<<15|k1>>>17,k1=(65535&k1)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295,h1^=k1}return h1^=key.length,h1^=h1>>>16,h1=2246822507*(65535&h1)+((2246822507*(h1>>>16)&65535)<<16)&4294967295,h1^=h1>>>13,h1=3266489909*(65535&h1)+((3266489909*(h1>>>16)&65535)<<16)&4294967295,h1^=h1>>>16,h1>>>0},hasLocalStorage:function(){try{return!!window.localStorage}catch(e){return!0}},hasSessionStorage:function(){try{return!!window.sessionStorage}catch(e){return!0}},isCanvasSupported:function(){var elem=document.createElement("canvas");return!(!elem.getContext||!elem.getContext("2d"))},isIE:function(){return"Microsoft Internet Explorer"===navigator.appName||!("Netscape"!==navigator.appName||!/Trident/.test(navigator.userAgent))},getPluginsString:function(){return this.isIE()&&this.ie_activex?this.getIEPluginsString():this.getRegularPluginsString()},getRegularPluginsString:function(){return this.map(navigator.plugins,function(p){var mimeTypes=this.map(p,function(mt){return[mt.type,mt.suffixes].join("~")}).join(",");return[p.name,p.description,mimeTypes].join("::")},this).join(";")},getIEPluginsString:function(){if(window.ActiveXObject){var names=["ShockwaveFlash.ShockwaveFlash","AcroPDF.PDF","PDF.PdfCtrl","QuickTime.QuickTime","rmocx.RealPlayer G2 Control","rmocx.RealPlayer G2 Control.1","RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)","RealVideo.RealVideo(tm) ActiveX Control (32-bit)","RealPlayer","SWCtl.SWCtl","WMPlayer.OCX","AgControl.AgControl","Skype.Detection"];return this.map(names,function(name){try{return new ActiveXObject(name),name}catch(e){return null}}).join(";")}return""},getScreenResolution:function(){var resolution;return resolution=this.screen_orientation?screen.height>screen.width?[screen.height,screen.width]:[screen.width,screen.height]:[screen.height,screen.width]},getCanvasFingerprint:function(){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),txt="clickyab";return ctx.textBaseline="top",ctx.font="14px 'Arial'",ctx.textBaseline="alphabetic",ctx.fillStyle="#f60",ctx.fillRect(125,1,62,20),ctx.fillStyle="#069",ctx.fillText(txt,2,15),ctx.fillStyle="rgba(102, 204, 0, 0.7)",ctx.fillText(txt,4,17),canvas.toDataURL()}},Fingerprint});var fp=new Fingerprint,uid=fp.get();!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.VMAP=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var ADBreak;ADBreak=function(){function ADBreak(){this.breakType=null,this.timeOffset=null,this.breakId=null,this.allowMultipleAds=!1,this.followRedirects=!0,this.id=null,this.templateType=null,this.vastAdData=null,this.adTagURI=null,this.isWrapper=!1,this.trackingEvent=null}return ADBreak}(),module.exports=ADBreak},{}],2:[function(require,module,exports){var ADSource;ADSource=function(){function ADSource(){this.allowMultipleAds=!1,this.followRedirects=!1,this.id=null,this.templateType=null,this.vastAdData=null,this.adTagURI=null,this.isWrapper=!1}return ADSource}(),module.exports=ADSource},{}],3:[function(require,module,exports){var VMAPClient,VMAPParser,VMAPUtil;VMAPParser=require("./parser.coffee"),VMAPUtil=require("./vmaputil.coffee"),VMAPClient=function(){function VMAPClient(){}return VMAPClient.options={withCredentials:!0,timeout:0},VMAPClient.get=function(url,opts,cb){var extend,options;return extend=exports.extend=function(object,properties){var key,val;for(key in properties)val=properties[key],object[key]=val;return object},cb||("function"==typeof opts&&(cb=opts),options={}),options=extend(this.options,opts),VMAPParser.parse(url,options,function(_this){return function(response){return cb(response)}}(this))},VMAPClient}(),module.exports=VMAPClient},{"./parser.coffee":5,"./vmaputil.coffee":10}],4:[function(require,module,exports){var EventEmitter,EventTracker,VMAPUtil,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;VMAPUtil=require("./vmaputil.coffee"),EventEmitter=require("events").EventEmitter,EventTracker=function(superClass){function EventTracker(trackingEvents){this.trackingEvents=trackingEvents}return extend(EventTracker,superClass),EventTracker.prototype.breakStart=function(){return this.track("breakStart")},EventTracker.prototype.breakEnd=function(){return this.track("breakEnd")},EventTracker.prototype.error=function(error){return this.track("error",!1,error)},EventTracker.prototype.track=function(eventName,once,variables){var trackingURLTemplates;null==once&&(once=!1),trackingURLTemplates=this.trackingEvents[eventName],null!=trackingURLTemplates&&this.trackURLs(trackingURLTemplates),once===!0&&delete this.trackingEvents[eventName]},EventTracker.prototype.trackURLs=function(URLTemplates,variables){return null==variables&&(variables={}),VMAPUtil.track(URLTemplates,variables)},EventTracker}(EventEmitter),module.exports=EventTracker},{"./vmaputil.coffee":10,events:11}],5:[function(require,module,exports){var AdBreak,AdSource,EventEmitter,URLHandler,VMAPParser,VMAPResponse,VMAPUtil;URLHandler=require("./urlhandler.coffee"),AdBreak=require("./adbreak.coffee"),AdSource=require("./addata.coffee"),VMAPResponse=require("./vmapresponse.coffee"),EventEmitter=require("events").EventEmitter,VMAPUtil=require("./vmaputil.coffee"),VMAPParser=function(){function VMAPParser(){}return VMAPParser.parse=function(url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),this._parse(url,null,options,function(err,response){return cb(response)})},VMAPParser.vent=new EventEmitter,VMAPParser.track=function(templates,errorCode){return this.vent.emit("VMAP-error",errorCode),VMAPUtil.track(templates,errorCode)},VMAPParser._parseSource=function(err,xml,cb){var adBreak,complete,extensions,i,j,len,len1,node,ref,ref1,response;if(null!=err)return cb(err);if(response=new VMAPResponse,response.adbreaks=[],null==(null!=xml?xml.documentElement:void 0)||"VMAP"!==xml.documentElement.nodeName&&"VMAP"!==xml.documentElement.nodeName)return cb();for(ref=xml.documentElement.childNodes,i=0,len=ref.length;i<len;i++)node=ref[i],"Error"===node.nodeName&&response.errorURLTemplates.push(this.parseNodeText(node));for(ref1=xml.documentElement.childNodes,j=0,len1=ref1.length;j<len1;j++)switch(node=ref1[j],node.nodeName){case"AdBreak":adBreak=this.parseAdBreakElement(node),null!=adBreak&&"end"!=adBreak.timeOffset?response.adbreaks.push(adBreak):this.track(response.errorURLTemplates,{ERRORCODE:101});break;case"Extensions":extensions=this.parseExtensionElement(node)}return(complete=function(_this){return function(errorAlreadyRaised){if(null==errorAlreadyRaised&&(errorAlreadyRaised=!1),response)return 0===response.adbreaks.length&&(errorAlreadyRaised||_this.track(response.errorURLTemplates,{ERRORCODE:303}),response=null),cb(null,response)}}(this))()},VMAPParser._parse=function(url,parentURLs,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),URLHandler.get(url,options,function(_this){return function(err,xml){return _this._parseSource(err,xml,cb)}}(this))},VMAPParser.parseExtensionElement=function(extensionsElement){return null},VMAPParser.parseAdBreakElement=function(adBreakElement){var adBreak,adSource,extensions,i,len,node,ref,trackingEvents;for(adBreak=new AdBreak,adBreak.breakType=adBreakElement.getAttribute("breakType"),adBreak.breakId=adBreakElement.getAttribute("breakId"),adBreak.timeOffset=adBreakElement.getAttribute("timeOffset"),ref=adBreakElement.childNodes,i=0,len=ref.length;i<len;i++)switch(node=ref[i],node.nodeName){case"AdSource":adSource=this.parseAdSource(node),adSource&&(adBreak.allowMultipleAds=adSource.allowMultipleAds,adBreak.followRedirects=adSource.followRedirects,adBreak.id=adSource.id,adBreak.templateType=adSource.templateType,adBreak.vastAdData=adSource.vastAdData,adBreak.adTagURI=adSource.adTagURI,adBreak.isWrapper=adSource.isWrapper);break;case"TrackingEvents":trackingEvents=this.parseTrackingEvent(node),trackingEvents&&(adBreak.trackingEvent=trackingEvents);break;case"Extensions":extensions=this.parseExtensionElement(node)}return adBreak},VMAPParser.parseTrackingEvent=function(trackingEventElement){var i,len,ref,trackingElement,trackingEvent;for(trackingEvent={},trackingEvent.breakStart=[],trackingEvent.breakEnd=[],trackingEvent.error=[],ref=trackingEventElement.childNodes,i=0,len=ref.length;i<len;i++)if(trackingElement=ref[i],void 0!==trackingElement.getAttribute)switch(trackingElement.getAttribute("event")){case"breakStart":trackingEvent.breakStart.push(this.parseNodeText(trackingElement));break;case"breakEnd":trackingEvent.breakEnd.push(this.parseNodeText(trackingElement));break;case"error":trackingEvent.error.push(this.parseNodeText(trackingElement))}return trackingEvent},VMAPParser.parseAdSource=function(adSourceElement){var adSource,i,len,node,ref;for(adSource=new AdSource,adSource.allowMultipleAds=VMAPUtil.parseBoolean(adSourceElement.getAttribute("allowMultipleAds")),adSource.followRedirects=VMAPUtil.parseBoolean(adSourceElement.getAttribute("followRedirects")),adSource.id=adSourceElement.getAttribute("id"),ref=adSourceElement.childNodes,i=0,len=ref.length;i<len;i++)switch(node=ref[i],node.nodeName){case"VASTData":adSource.vastAdData=node.childNodes,adSource.templateType="vast3";break;case"AdTagURI":adSource.adTagURI=this.parseNodeText(node),adSource.templateType=node.getAttribute("templateType"),adSource.isWrapper=!0;break;case"CustomAdData":adSource.vastAdData=node.childNodes,adSource.templateType=node.getAttribute("templateType")}return adSource},VMAPParser.parseNodeText=function(node){return node&&(node.textContent||node.text||"").trim()},VMAPParser.isUrl=function(node){return/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?\/\/=]*)/i.test(this.parseNodeText(node))},VMAPParser}(),module.exports=VMAPParser},{"./adbreak.coffee":1,"./addata.coffee":2,"./urlhandler.coffee":6,"./vmapresponse.coffee":9,"./vmaputil.coffee":10,events:11}],6:[function(require,module,exports){var URLHandler,flash,xhr;xhr=require("./urlhandlers/xmlhttprequest.coffee"),flash=require("./urlhandlers/flash.coffee"),URLHandler=function(){function URLHandler(){}return URLHandler.get=function(url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),options.urlhandler&&options.urlhandler.supported()?options.urlhandler.get(url,options,cb):"undefined"==typeof window||null===window?require("./urlhandlers/node.coffee").get(url,options,cb):xhr.supported()?xhr.get(url,options,cb):flash.supported()?flash.get(url,options,cb):cb()},URLHandler}(),module.exports=URLHandler},{"./urlhandlers/flash.coffee":7,"./urlhandlers/xmlhttprequest.coffee":8}],7:[function(require,module,exports){var FlashURLHandler;FlashURLHandler=function(){function FlashURLHandler(){}return FlashURLHandler.xdr=function(){var xdr;return window.XDomainRequest&&(xdr=new XDomainRequest),xdr},FlashURLHandler.supported=function(){return!!this.xdr()},FlashURLHandler.get=function(url,options,cb){var xdr,xmlDocument;return(xmlDocument="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(xmlDocument.async=!1,xdr=this.xdr(),xdr.open("GET",url),xdr.timeout=options.timeout||0,xdr.withCredentials=options.withCredentials||!1,xdr.send(),xdr.onload=function(){return xmlDocument.loadXML(xdr.responseText),cb(null,xmlDocument)}):cb()},FlashURLHandler}(),module.exports=FlashURLHandler},{}],8:[function(require,module,exports){var XHRURLHandler;XHRURLHandler=function(){function XHRURLHandler(){}return XHRURLHandler.xhr=function(){var xhr;if(xhr=new window.XMLHttpRequest,"withCredentials"in xhr)return xhr},XHRURLHandler.supported=function(){return!!this.xhr()},XHRURLHandler.get=function(url,options,cb){var xhr;try{return xhr=this.xhr(),url=url+"&tid="+uid+"&l=1",xhr.open("GET",url),xhr.timeout=options.timeout||0,xhr.withCredentials=options.withCredentials||!1,xhr.send(),xhr.onreadystatechange=function(){if(4===xhr.readyState)return cb(null,xhr.responseXML)}}catch(error){return cb()}},XHRURLHandler}(),module.exports=XHRURLHandler},{}],9:[function(require,module,exports){var VMAPResponse;VMAPResponse=function(){function VMAPResponse(){}return VMAPResponse.adbreaks=[],VMAPResponse}(),module.exports=VMAPResponse},{}],10:[function(require,module,exports){var VMAPUtil;VMAPUtil=function(){function VMAPUtil(){}return VMAPUtil.track=function(URLTemplates,variables){var URL,URLs,i,j,len,results;if(null!=URLTemplates){for(URLs=this.resolveURLTemplates(URLTemplates,variables),results=[],j=0,len=URLs.length;j<len;j++)URL=URLs[j],"undefined"!=typeof window&&null!==window&&(i=new Image,results.push(i.src=URL));return results}},VMAPUtil.resolveURLTemplates=function(URLTemplates,variables){var URLTemplate,URLs,j,key,len,macro1,macro2,resolveURL,value;URLs=[],null==variables&&(variables={}),"CACHEBUSTING"in variables||(variables.CACHEBUSTING=Math.round(1e10*Math.random())),variables.random=variables.CACHEBUSTING;for(j=0,len=URLTemplates.length;j<len;j++)if(URLTemplate=URLTemplates[j],resolveURL=URLTemplate){for(key in variables)value=variables[key],macro1="["+key+"]",macro2="%%"+key+"%%",resolveURL=resolveURL.replace(macro1,value),resolveURL=resolveURL.replace(macro2,value);URLs.push(resolveURL)}return URLs},VMAPUtil.parseBoolean=function(string){var bool;if(bool=function(){switch(!1){case"true"!==string.toLowerCase():return!0;case"false"!==string.toLowerCase():return!1}}(),"boolean"==typeof bool)return bool},VMAPUtil}(),module.exports=VMAPUtil},{}],11:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],12:[function(require,module,exports){module.exports={client:require("./client.coffee"),parser:require("./parser.coffee"),util:require("./vmaputil.coffee"),tracker:require("./eventtracker.coffee")}},{"./client.coffee":3,"./eventtracker.coffee":4,"./parser.coffee":5,"./vmaputil.coffee":10}]},{},[12])(12)}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.DMVAST=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],2:[function(_dereq_,module,exports){var VASTAd;VASTAd=function(){function VASTAd(){this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]}return VASTAd}(),module.exports=VASTAd},{}],3:[function(_dereq_,module,exports){var VASTClient,VASTParser,VASTUtil;VASTParser=_dereq_("./parser.coffee"),VASTUtil=_dereq_("./util.coffee"),VASTClient=function(){function VASTClient(){}return VASTClient.cappingFreeLunch=0,VASTClient.cappingMinimumTimeInterval=0,VASTClient.options={withCredentials:!1,timeout:0},VASTClient.get=function(url,opts,cb){var extend,now,options;return now=+new Date,extend=exports.extend=function(object,properties){var key,val;for(key in properties)val=properties[key],object[key]=val;return object},cb||("function"==typeof opts&&(cb=opts),options={}),options=extend(this.options,opts),this.totalCallsTimeout<now?(this.totalCalls=1,this.totalCallsTimeout=now+36e5):this.totalCalls++,this.cappingFreeLunch>=this.totalCalls?void cb(null):now-this.lastSuccessfullAd<this.cappingMinimumTimeInterval?void cb(null):VASTParser.parse(url,options,function(_this){return function(response){return cb(response)}}(this))},VASTClient.parse=function(xml,url,opts,cb){var extend,now,options;return now=+new Date,extend=exports.extend=function(object,properties){var key,val;for(key in properties)val=properties[key],object[key]=val;return object},cb||("function"==typeof opts&&(cb=opts),options={}),options=extend(this.options,opts),this.totalCallsTimeout<now?(this.totalCalls=1,this.totalCallsTimeout=now+36e5):this.totalCalls++,this.cappingFreeLunch>=this.totalCalls?void cb(null):now-this.lastSuccessfullAd<this.cappingMinimumTimeInterval?void cb(null):VASTParser.parseContent(xml,url,options,function(_this){return function(response){return cb(response)}}(this))},function(){var defineProperty,storage;storage=VASTUtil.storage,defineProperty=Object.defineProperty,["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach(function(property){defineProperty(VASTClient,property,{get:function(){return storage.getItem(property)},set:function(value){return storage.setItem(property,value)},configurable:!1,enumerable:!0})}),null==VASTClient.totalCalls&&(VASTClient.totalCalls=0),null==VASTClient.totalCallsTimeout&&(VASTClient.totalCallsTimeout=0)}(),VASTClient}(),module.exports=VASTClient},{"./parser.coffee":9,"./util.coffee":15}],4:[function(_dereq_,module,exports){var VASTCompanionAd;VASTCompanionAd=function(){function VASTCompanionAd(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.companionClickThroughURLTemplate=null,this.trackingEvents={}}return VASTCompanionAd}(),module.exports=VASTCompanionAd},{}],5:[function(_dereq_,module,exports){var VASTCreative,VASTCreativeCompanion,VASTCreativeLinear,VASTCreativeNonLinear,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};VASTCreative=function(){function VASTCreative(){this.trackingEvents={}}return VASTCreative}(),VASTCreativeLinear=function(_super){function VASTCreativeLinear(){VASTCreativeLinear.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[]}return __extends(VASTCreativeLinear,_super),VASTCreativeLinear}(VASTCreative),VASTCreativeNonLinear=function(_super){function VASTCreativeNonLinear(){return VASTCreativeNonLinear.__super__.constructor.apply(this,arguments)}return __extends(VASTCreativeNonLinear,_super),VASTCreativeNonLinear}(VASTCreative),VASTCreativeCompanion=function(_super){function VASTCreativeCompanion(){this.type="companion",this.variations=[],this.videoClickTrackingURLTemplates=[]}return __extends(VASTCreativeCompanion,_super),VASTCreativeCompanion}(VASTCreative),module.exports={VASTCreativeLinear:VASTCreativeLinear,VASTCreativeNonLinear:VASTCreativeNonLinear,VASTCreativeCompanion:VASTCreativeCompanion}},{}],6:[function(_dereq_,module,exports){var VASTExtension;VASTExtension=function(){function VASTExtension(){this.name="",this.attributes={},this.children={},this.textContent=""}return VASTExtension}(),module.exports=VASTExtension},{}],7:[function(_dereq_,module,exports){module.exports={client:_dereq_("./client.coffee"),tracker:_dereq_("./tracker.coffee"),parser:_dereq_("./parser.coffee"),util:_dereq_("./util.coffee")}},{"./client.coffee":3,"./parser.coffee":9,"./tracker.coffee":11,"./util.coffee":15}],8:[function(_dereq_,module,exports){var VASTMediaFile;VASTMediaFile=function(){function VASTMediaFile(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,
this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}return VASTMediaFile}(),module.exports=VASTMediaFile},{}],9:[function(_dereq_,module,exports){var EventEmitter,URLHandler,VASTAd,VASTCompanionAd,VASTCreativeCompanion,VASTCreativeLinear,VASTExtension,VASTMediaFile,VASTParser,VASTResponse,VASTUtil,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};URLHandler=_dereq_("./urlhandler.coffee"),VASTResponse=_dereq_("./response.coffee"),VASTAd=_dereq_("./ad.coffee"),VASTUtil=_dereq_("./util.coffee"),VASTCreativeLinear=_dereq_("./creative.coffee").VASTCreativeLinear,VASTCreativeCompanion=_dereq_("./creative.coffee").VASTCreativeCompanion,VASTExtension=_dereq_("./extension.coffee"),VASTMediaFile=_dereq_("./mediafile.coffee"),VASTCompanionAd=_dereq_("./companionad.coffee"),EventEmitter=_dereq_("events").EventEmitter,VASTParser=function(){function VASTParser(){}var URLTemplateFilters;return URLTemplateFilters=[],VASTParser.addURLTemplateFilter=function(func){"function"==typeof func&&URLTemplateFilters.push(func)},VASTParser.removeURLTemplateFilter=function(){return URLTemplateFilters.pop()},VASTParser.countURLTemplateFilters=function(){return URLTemplateFilters.length},VASTParser.clearUrlTemplateFilters=function(){return URLTemplateFilters=[]},VASTParser.parse=function(url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),this._parse(url,null,options,function(err,response){return cb(response)})},VASTParser.parseContent=function(xml,url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),this._parseContent(xml,url,null,options,function(err,response){return cb(response)})},VASTParser.vent=new EventEmitter,VASTParser.track=function(templates,errorCode){return this.vent.emit("VAST-error",errorCode),VASTUtil.track(templates,errorCode)},VASTParser.on=function(eventName,cb){return this.vent.on(eventName,cb)},VASTParser.once=function(eventName,cb){return this.vent.once(eventName,cb)},VASTParser._parse=function(url,parentURLs,options,cb){var filter,_i,_len;for(cb||("function"==typeof options&&(cb=options),options={}),_i=0,_len=URLTemplateFilters.length;_i<_len;_i++)filter=URLTemplateFilters[_i],url=filter(url);return null==parentURLs&&(parentURLs=[]),parentURLs.push(url),URLHandler.get(url,options,function(_this){return function(err,xml){return null!=err?cb(err):_this._parseNode(url,xml,parentURLs,options,cb)}}(this))},VASTParser._parseContent=function(xml,url,parentURLs,options,cb){var filter,_i,_len;for(cb||("function"==typeof options&&(cb=options),options={}),_i=0,_len=URLTemplateFilters.length;_i<_len;_i++)filter=URLTemplateFilters[_i],url=filter(url);return null==parentURLs&&(parentURLs=[]),parentURLs.push(url),this._parseNode(url,xml,parentURLs,options,cb)},VASTParser._parseNode=function(url,xml,parentURLs,options,cb){var ad,complete,loopIndex,node,response,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3;if(response=new VASTResponse,(null==(null!=xml?xml.documentElement:void 0)||"VAST"!==xml.documentElement.nodeName&&"VideoAdServingTemplate"!==xml.documentElement.nodeName)&&(null==(null!=xml?xml.nodeName:void 0)||"VAST"!==xml.nodeName&&"VideoAdServingTemplate"!==xml.nodeName))return cb;if(null!=(null!=xml?xml.documentElement:void 0)){for(_ref=xml.documentElement.childNodes,_i=0,_len=_ref.length;_i<_len;_i++)node=_ref[_i],"Error"===node.nodeName&&response.errorURLTemplates.push(this.parseNodeText(node));for(_ref1=xml.documentElement.childNodes,_j=0,_len1=_ref1.length;_j<_len1;_j++)node=_ref1[_j],"Ad"===node.nodeName&&(ad=this.parseAdElement(node),null!=ad?response.ads.push(ad):this.track(response.errorURLTemplates,{ERRORCODE:101}))}else{for(_ref2=xml.childNodes,_k=0,_len2=_ref2.length;_k<_len2;_k++)node=_ref2[_k],"Error"===node.nodeName&&response.errorURLTemplates.push(this.parseNodeText(node));for(_ref3=xml.childNodes,_l=0,_len3=_ref3.length;_l<_len3;_l++)node=_ref3[_l],"Ad"===node.nodeName&&(ad=this.parseAdElement(node),null!=ad?response.ads.push(ad):this.track(response.errorURLTemplates,{ERRORCODE:101}))}for(complete=function(_this){return function(errorAlreadyRaised){var _len4,_m,_ref4;if(null==errorAlreadyRaised&&(errorAlreadyRaised=!1),response){for(_ref4=response.ads,_m=0,_len4=_ref4.length;_m<_len4;_m++)if(ad=_ref4[_m],null!=ad.nextWrapperURL)return;return 0===response.ads.length&&(errorAlreadyRaised||_this.track(response.errorURLTemplates,{ERRORCODE:303}),response=null),cb(null,response)}}}(this),loopIndex=response.ads.length;loopIndex--;)ad=response.ads[loopIndex],null!=ad.nextWrapperURL&&!function(_this){return function(ad){var baseURL,_ref4;return parentURLs.length>=10||(_ref4=ad.nextWrapperURL,__indexOf.call(parentURLs,_ref4)>=0)?(_this.track(ad.errorURLTemplates,{ERRORCODE:302}),response.ads.splice(response.ads.indexOf(ad),1),void complete()):(ad.nextWrapperURL.indexOf("://")===-1&&(baseURL=url.slice(0,url.lastIndexOf("/")),ad.nextWrapperURL=""+baseURL+"/"+ad.nextWrapperURL),_this._parse(ad.nextWrapperURL,parentURLs,options,function(err,wrappedResponse){var creative,errorAlreadyRaised,eventName,index,wrappedAd,_base,_len4,_len5,_len6,_len7,_m,_n,_o,_p,_ref5,_ref6,_ref7,_ref8;if(errorAlreadyRaised=!1,null!=err)_this.track(ad.errorURLTemplates,{ERRORCODE:301}),response.ads.splice(response.ads.indexOf(ad),1),errorAlreadyRaised=!0;else if(null==wrappedResponse)_this.track(ad.errorURLTemplates,{ERRORCODE:303}),response.ads.splice(response.ads.indexOf(ad),1),errorAlreadyRaised=!0;else for(response.errorURLTemplates=response.errorURLTemplates.concat(wrappedResponse.errorURLTemplates),index=response.ads.indexOf(ad),response.ads.splice(index,1),_ref5=wrappedResponse.ads,_m=0,_len4=_ref5.length;_m<_len4;_m++){if(wrappedAd=_ref5[_m],wrappedAd.errorURLTemplates=ad.errorURLTemplates.concat(wrappedAd.errorURLTemplates),wrappedAd.impressionURLTemplates=ad.impressionURLTemplates.concat(wrappedAd.impressionURLTemplates),null!=ad.trackingEvents)for(_ref6=wrappedAd.creatives,_n=0,_len5=_ref6.length;_n<_len5;_n++)if(creative=_ref6[_n],"linear"===creative.type)for(_ref7=Object.keys(ad.trackingEvents),_o=0,_len6=_ref7.length;_o<_len6;_o++)eventName=_ref7[_o],(_base=creative.trackingEvents)[eventName]||(_base[eventName]=[]),creative.trackingEvents[eventName]=creative.trackingEvents[eventName].concat(ad.trackingEvents[eventName]);if(null!=ad.videoClickTrackingURLTemplates)for(_ref8=wrappedAd.creatives,_p=0,_len7=_ref8.length;_p<_len7;_p++)creative=_ref8[_p],"linear"===creative.type&&(creative.videoClickTrackingURLTemplates=creative.videoClickTrackingURLTemplates.concat(ad.videoClickTrackingURLTemplates));response.ads.splice(index,0,wrappedAd)}return delete ad.nextWrapperURL,complete(errorAlreadyRaised)}))}}(this)(ad);return complete()},VASTParser.childByName=function(node,name){var child,_i,_len,_ref;for(_ref=node.childNodes,_i=0,_len=_ref.length;_i<_len;_i++)if(child=_ref[_i],child.nodeName===name)return child},VASTParser.childsByName=function(node,name){var child,childs,_i,_len,_ref;for(childs=[],_ref=node.childNodes,_i=0,_len=_ref.length;_i<_len;_i++)child=_ref[_i],child.nodeName===name&&childs.push(child);return childs},VASTParser.parseAdElement=function(adElement){var adTypeElement,_i,_len,_ref;for(_ref=adElement.childNodes,_i=0,_len=_ref.length;_i<_len;_i++){if(adTypeElement=_ref[_i],"Wrapper"===adTypeElement.nodeName)return this.parseWrapperElement(adTypeElement);if("InLine"===adTypeElement.nodeName)return this.parseInLineElement(adTypeElement)}},VASTParser.parseWrapperElement=function(wrapperElement){var ad,creative,wrapperCreativeElement,wrapperURLElement,_i,_len,_ref;for(ad=this.parseInLineElement(wrapperElement),wrapperURLElement=this.childByName(wrapperElement,"VASTAdTagURI"),null!=wrapperURLElement?ad.nextWrapperURL=this.parseNodeText(wrapperURLElement):(wrapperURLElement=this.childByName(wrapperElement,"VASTAdTagURL"),null!=wrapperURLElement&&(ad.nextWrapperURL=this.parseNodeText(this.childByName(wrapperURLElement,"URL")))),wrapperCreativeElement=null,_ref=ad.creatives,_i=0,_len=_ref.length;_i<_len;_i++)if(creative=_ref[_i],"linear"===creative.type){wrapperCreativeElement=creative;break}if(null!=wrapperCreativeElement&&(null!=wrapperCreativeElement.trackingEvents&&(ad.trackingEvents=wrapperCreativeElement.trackingEvents),null!=wrapperCreativeElement.videoClickTrackingURLTemplates&&(ad.videoClickTrackingURLTemplates=wrapperCreativeElement.videoClickTrackingURLTemplates)),null!=ad.nextWrapperURL)return ad},VASTParser.parseInLineElement=function(inLineElement){var ad,creative,creativeElement,creativeTypeElement,extensionElement,node,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3;for(ad=new VASTAd,_ref=inLineElement.childNodes,_i=0,_len=_ref.length;_i<_len;_i++)switch(node=_ref[_i],node.nodeName){case"Error":this.isUrl(node)&&ad.errorURLTemplates.push(this.parseNodeText(node));break;case"Impression":this.isUrl(node)&&ad.impressionURLTemplates.push(this.parseNodeText(node));break;case"Creatives":for(_ref1=this.childsByName(node,"Creative"),_j=0,_len1=_ref1.length;_j<_len1;_j++)for(creativeElement=_ref1[_j],_ref2=creativeElement.childNodes,_k=0,_len2=_ref2.length;_k<_len2;_k++)switch(creativeTypeElement=_ref2[_k],creativeTypeElement.nodeName){case"Linear":creative=this.parseCreativeLinearElement(creativeTypeElement),creative&&ad.creatives.push(creative);break;case"CompanionAds":creative=this.parseCompanionAd(creativeTypeElement),creative&&ad.creatives.push(creative)}break;case"Video":creative=this.parseDeprecatedLinearElement(node.parentNode),creative&&ad.creatives.push(creative);break;case"CompanionAds":creative=this.parseDeprecatedCompanionAd(node),creative&&ad.creatives.push(creative);break;case"Extensions":for(_ref3=this.childsByName(node,"Extension"),_l=0,_len3=_ref3.length;_l<_len3;_l++)extensionElement=_ref3[_l],ad.extensions.push(this.parseExtensionElement(extensionElement))}return ad},VASTParser.parseExtensionElement=function(extensionElement){var attribute,child,extension,_i,_j,_len,_len1,_ref,_ref1;if(extension=new VASTExtension,extension.name=extensionElement.nodeName,extensionElement.hasAttributes())for(_ref=extensionElement.attributes,_i=0,_len=_ref.length;_i<_len;_i++)attribute=_ref[_i],extension.attributes[attribute.name]=attribute.value;if(extensionElement.hasChildNodes())for(_ref1=extensionElement.childNodes,_j=0,_len1=_ref1.length;_j<_len1;_j++)child=_ref1[_j],child.nodeType===Node.ELEMENT_NODE?extension.children[child.nodeName]=this.parseExtensionElement(child):child.nodeType===Node.CDATA_SECTION_NODE&&(extension.textContent=child.textContent);return extension},VASTParser.parseDeprecatedLinearElement=function(creativeElement){var creative,eventName,maintainAspectRatio,mediaFile,mediaFileElement,mediaFilesElement,scalable,trackingElement,trackingEventsElement,trackingURLTemplate,video,_base,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3;for(creative=new VASTCreativeLinear,video=this.childByName(creativeElement,"Video"),creative.duration=this.parseDuration(this.parseNodeText(this.childByName(video,"Duration"))),_ref=this.childsByName(creativeElement,"TrackingEvents"),_i=0,_len=_ref.length;_i<_len;_i++)for(trackingEventsElement=_ref[_i],_ref1=this.childsByName(trackingEventsElement,"Tracking"),_j=0,_len1=_ref1.length;_j<_len1;_j++)trackingElement=_ref1[_j],eventName=trackingElement.getAttribute("event"),trackingURLTemplate=this.parseNodeText(trackingElement),null!=eventName&&null!=trackingURLTemplate&&(null==(_base=creative.trackingEvents)[eventName]&&(_base[eventName]=[]),creative.trackingEvents[eventName].push(trackingURLTemplate));for(_ref2=this.childsByName(video,"MediaFiles"),_k=0,_len2=_ref2.length;_k<_len2;_k++)for(mediaFilesElement=_ref2[_k],_ref3=this.childsByName(mediaFilesElement,"MediaFile"),_l=0,_len3=_ref3.length;_l<_len3;_l++)mediaFileElement=_ref3[_l],mediaFile=new VASTMediaFile,mediaFile.id=mediaFileElement.getAttribute("id"),mediaFile.fileURL=this.parseNodeText(mediaFileElement),mediaFile.deliveryType=mediaFileElement.getAttribute("delivery"),mediaFile.codec=mediaFileElement.getAttribute("codec"),mediaFile.mimeType=mediaFileElement.getAttribute("type"),"video/x-mp4"===mediaFile.mimeType&&(mediaFile.mimeType="video/mp4"),mediaFile.apiFramework=mediaFileElement.getAttribute("apiFramework"),mediaFile.bitrate=parseInt(mediaFileElement.getAttribute("bitrate")||0),mediaFile.minBitrate=parseInt(mediaFileElement.getAttribute("minBitrate")||0),mediaFile.maxBitrate=parseInt(mediaFileElement.getAttribute("maxBitrate")||0),mediaFile.width=parseInt(mediaFileElement.getAttribute("width")||0),mediaFile.height=parseInt(mediaFileElement.getAttribute("height")||0),scalable=mediaFileElement.getAttribute("scalable"),scalable&&"string"==typeof scalable&&(scalable=scalable.toLowerCase(),"true"===scalable?mediaFile.scalable=!0:"false"===scalable&&(mediaFile.scalable=!1)),maintainAspectRatio=mediaFileElement.getAttribute("maintainAspectRatio"),maintainAspectRatio&&"string"==typeof maintainAspectRatio&&(maintainAspectRatio=maintainAspectRatio.toLowerCase(),"true"===maintainAspectRatio?mediaFile.maintainAspectRatio=!0:"false"===maintainAspectRatio&&(mediaFile.maintainAspectRatio=!1)),creative.mediaFiles.push(mediaFile);return creative},VASTParser.parseCreativeLinearElement=function(creativeElement){var clickTrackingElement,creative,eventName,maintainAspectRatio,mediaFile,mediaFileElement,mediaFilesElement,percent,scalable,skipOffset,trackingElement,trackingEventsElement,trackingURLTemplate,videoClicksElement,_base,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref,_ref1,_ref2,_ref3,_ref4;if(creative=new VASTCreativeLinear,creative.duration=this.parseDuration(this.parseNodeText(this.childByName(creativeElement,"Duration"))),creative.duration===-1&&"Wrapper"!==creativeElement.parentNode.parentNode.parentNode.nodeName)return null;if(skipOffset=creativeElement.getAttribute("skipOffset"),null==skipOffset?creative.skipDelay=null:"%"===skipOffset.charAt(skipOffset.length-1)?(percent=parseInt(skipOffset,10),creative.skipDelay=creative.duration*(percent/100)):creative.skipDelay=this.parseDuration(skipOffset),videoClicksElement=this.childByName(creativeElement,"VideoClicks"),null!=videoClicksElement)for(creative.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(videoClicksElement,"ClickThrough")),_ref=this.childsByName(videoClicksElement,"ClickTracking"),_i=0,_len=_ref.length;_i<_len;_i++)clickTrackingElement=_ref[_i],creative.videoClickTrackingURLTemplates.push(this.parseNodeText(clickTrackingElement));for(_ref1=this.childsByName(creativeElement,"TrackingEvents"),_j=0,_len1=_ref1.length;_j<_len1;_j++)for(trackingEventsElement=_ref1[_j],_ref2=this.childsByName(trackingEventsElement,"Tracking"),_k=0,_len2=_ref2.length;_k<_len2;_k++)trackingElement=_ref2[_k],eventName=trackingElement.getAttribute("event"),trackingURLTemplate=this.parseNodeText(trackingElement),null!=eventName&&null!=trackingURLTemplate&&(null==(_base=creative.trackingEvents)[eventName]&&(_base[eventName]=[]),creative.trackingEvents[eventName].push(trackingURLTemplate));for(_ref3=this.childsByName(creativeElement,"MediaFiles"),_l=0,_len3=_ref3.length;_l<_len3;_l++)for(mediaFilesElement=_ref3[_l],_ref4=this.childsByName(mediaFilesElement,"MediaFile"),_m=0,_len4=_ref4.length;_m<_len4;_m++)mediaFileElement=_ref4[_m],mediaFile=new VASTMediaFile,mediaFile.id=mediaFileElement.getAttribute("id"),mediaFile.fileURL=this.parseNodeText(mediaFileElement),mediaFile.deliveryType=mediaFileElement.getAttribute("delivery"),mediaFile.codec=mediaFileElement.getAttribute("codec"),mediaFile.mimeType=mediaFileElement.getAttribute("type"),mediaFile.apiFramework=mediaFileElement.getAttribute("apiFramework"),mediaFile.bitrate=parseInt(mediaFileElement.getAttribute("bitrate")||0),mediaFile.minBitrate=parseInt(mediaFileElement.getAttribute("minBitrate")||0),mediaFile.maxBitrate=parseInt(mediaFileElement.getAttribute("maxBitrate")||0),mediaFile.width=parseInt(mediaFileElement.getAttribute("width")||0),mediaFile.height=parseInt(mediaFileElement.getAttribute("height")||0),scalable=mediaFileElement.getAttribute("scalable"),scalable&&"string"==typeof scalable&&(scalable=scalable.toLowerCase(),"true"===scalable?mediaFile.scalable=!0:"false"===scalable&&(mediaFile.scalable=!1)),maintainAspectRatio=mediaFileElement.getAttribute("maintainAspectRatio"),maintainAspectRatio&&"string"==typeof maintainAspectRatio&&(maintainAspectRatio=maintainAspectRatio.toLowerCase(),"true"===maintainAspectRatio?mediaFile.maintainAspectRatio=!0:"false"===maintainAspectRatio&&(mediaFile.maintainAspectRatio=!1)),creative.mediaFiles.push(mediaFile);return creative},VASTParser.parseDeprecatedCompanionAd=function(creativeElement){return this.parseCompanionAd(creativeElement)},VASTParser.parseCompanionAd=function(creativeElement){var companionAd,companionResource,creative,eventName,htmlElement,iframeElement,staticElement,trackingElement,trackingEventsElement,trackingURLTemplate,_base,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_len5,_m,_n,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;for(creative=new VASTCreativeCompanion,_ref=this.childsByName(creativeElement,"Companion"),_i=0,_len=_ref.length;_i<_len;_i++){for(companionResource=_ref[_i],companionAd=new VASTCompanionAd,companionAd.id=companionResource.getAttribute("id")||null,companionAd.width=companionResource.getAttribute("width"),companionAd.height=companionResource.getAttribute("height"),_ref1=this.childsByName(companionResource,"HTMLResource"),_j=0,_len1=_ref1.length;_j<_len1;_j++)htmlElement=_ref1[_j],companionAd.type=htmlElement.getAttribute("creativeType")||0,companionAd.htmlResource=this.parseNodeText(htmlElement);for(_ref2=this.childsByName(companionResource,"IFrameResource"),_k=0,_len2=_ref2.length;_k<_len2;_k++)iframeElement=_ref2[_k],companionAd.type=iframeElement.getAttribute("creativeType")||0,companionAd.iframeResource=this.parseNodeText(iframeElement);for(_ref3=this.childsByName(companionResource,"StaticResource"),_l=0,_len3=_ref3.length;_l<_len3;_l++)staticElement=_ref3[_l],companionAd.type=staticElement.getAttribute("creativeType")||0,companionAd.staticResource=this.parseNodeText(staticElement);for(_ref4=this.childsByName(companionResource,"TrackingEvents"),_m=0,_len4=_ref4.length;_m<_len4;_m++)for(trackingEventsElement=_ref4[_m],_ref5=this.childsByName(trackingEventsElement,"Tracking"),_n=0,_len5=_ref5.length;_n<_len5;_n++)trackingElement=_ref5[_n],eventName=trackingElement.getAttribute("event"),trackingURLTemplate=this.parseNodeText(trackingElement),null!=eventName&&null!=trackingURLTemplate&&(null==(_base=companionAd.trackingEvents)[eventName]&&(_base[eventName]=[]),companionAd.trackingEvents[eventName].push(trackingURLTemplate));companionAd.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(companionResource,"CompanionClickThrough")),creative.variations.push(companionAd)}return creative},VASTParser.parseDuration=function(durationString){var durationComponents,hours,minutes,seconds,secondsAndMS;return null==durationString?-1:(durationComponents=durationString.split(":"),3!==durationComponents.length?-1:(secondsAndMS=durationComponents[2].split("."),seconds=parseInt(secondsAndMS[0]),2===secondsAndMS.length&&(seconds+=parseFloat("0."+secondsAndMS[1])),minutes=parseInt(60*durationComponents[1]),hours=parseInt(60*durationComponents[0]*60),isNaN(hours||isNaN(minutes||isNaN(seconds||minutes>3600||seconds>60)))?-1:hours+minutes+seconds))},VASTParser.parseNodeText=function(node){return node&&(node.textContent||node.text||"").trim()},VASTParser.isUrl=function(node){return/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?\/\/=]*)/i.test(this.parseNodeText(node))},VASTParser}(),module.exports=VASTParser},{"./ad.coffee":2,"./companionad.coffee":4,"./creative.coffee":5,"./extension.coffee":6,"./mediafile.coffee":8,"./response.coffee":10,"./urlhandler.coffee":12,"./util.coffee":15,events:1}],10:[function(_dereq_,module,exports){var VASTResponse;VASTResponse=function(){function VASTResponse(){this.ads=[],this.errorURLTemplates=[]}return VASTResponse}(),module.exports=VASTResponse},{}],11:[function(_dereq_,module,exports){var EventEmitter,VASTClient,VASTCreativeLinear,VASTTracker,VASTUtil,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};VASTClient=_dereq_("./client.coffee"),VASTUtil=_dereq_("./util.coffee"),VASTCreativeLinear=_dereq_("./creative.coffee").VASTCreativeLinear,EventEmitter=_dereq_("events").EventEmitter,VASTTracker=function(_super){function VASTTracker(ad,creative){var eventName,events,_ref;this.ad=ad,this.creative=creative,this.muted=!1,this.impressed=!1,this.skipable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],_ref=creative.trackingEvents;for(eventName in _ref)events=_ref[eventName],this.trackingEvents[eventName]=events.slice(0);creative instanceof VASTCreativeLinear?(this.setDuration(creative.duration),this.skipDelay=creative.skipDelay,this.linear=!0,this.clickThroughURLTemplate=creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=creative.videoClickTrackingURLTemplates):(this.skipDelay=-1,this.linear=!1),this.on("start",function(){VASTClient.lastSuccessfullAd=+new Date})}return __extends(VASTTracker,_super),VASTTracker.prototype.setDuration=function(duration){return this.assetDuration=duration,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}},VASTTracker.prototype.setProgress=function(progress){var eventName,events,percent,quartile,skipDelay,time,_i,_len,_ref;if(skipDelay=null===this.skipDelay?this.skipDelayDefault:this.skipDelay,skipDelay===-1||this.skipable||(skipDelay>progress?this.emit("skip-countdown",skipDelay-progress):(this.skipable=!0,this.emit("skip-countdown",0))),this.linear&&this.assetDuration>0){if(events=[],progress>0){events.push("start"),percent=Math.round(progress/this.assetDuration*100),events.push("progress-"+percent+"%"),_ref=this.quartiles;for(quartile in _ref)time=_ref[quartile],time<=progress&&progress<=time+1&&events.push(quartile)}for(_i=0,_len=events.length;_i<_len;_i++)eventName=events[_i],this.track(eventName,!0);progress<this.progress&&this.track("rewind")}return this.progress=progress},VASTTracker.prototype.setMuted=function(muted){return this.muted!==muted&&this.track(muted?"mute":"unmute"),this.muted=muted},VASTTracker.prototype.setPaused=function(paused){return this.paused!==paused&&this.track(paused?"pause":"resume"),this.paused=paused},VASTTracker.prototype.setFullscreen=function(fullscreen){return this.fullscreen!==fullscreen&&this.track(fullscreen?"fullscreen":"exitFullscreen"),this.fullscreen=fullscreen},VASTTracker.prototype.setSkipDelay=function(duration){if("number"==typeof duration)return this.skipDelay=duration},VASTTracker.prototype.load=function(){if(!this.impressed)return this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView")},VASTTracker.prototype.errorWithCode=function(errorCode){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:errorCode})},VASTTracker.prototype.complete=function(){return this.track("complete")},VASTTracker.prototype.stop=function(){return this.track(this.linear?"closeLinear":"close")},VASTTracker.prototype.skip=function(){return this.track("skip"),this.trackingEvents=[]},VASTTracker.prototype.click=function(){var clickThroughURL,variables,_ref;if((null!=(_ref=this.clickTrackingURLTemplates)?_ref.length:void 0)&&this.trackURLs(this.clickTrackingURLTemplates),null!=this.clickThroughURLTemplate)return this.linear&&(variables={CONTENTPLAYHEAD:this.progressFormated()}),clickThroughURL=VASTUtil.resolveURLTemplates([this.clickThroughURLTemplate],variables)[0],this.emit("clickthrough",clickThroughURL)},VASTTracker.prototype.track=function(eventName,once){var idx,trackingURLTemplates;null==once&&(once=!1),"closeLinear"===eventName&&null==this.trackingEvents[eventName]&&null!=this.trackingEvents.close&&(eventName="close"),trackingURLTemplates=this.trackingEvents[eventName],idx=this.emitAlwaysEvents.indexOf(eventName),null!=trackingURLTemplates?(this.emit(eventName,""),this.trackURLs(trackingURLTemplates)):idx!==-1&&this.emit(eventName,""),once===!0&&(delete this.trackingEvents[eventName],idx>-1&&this.emitAlwaysEvents.splice(idx,1))},VASTTracker.prototype.trackURLs=function(URLTemplates,variables){return null==variables&&(variables={}),this.linear&&(variables.CONTENTPLAYHEAD=this.progressFormated()),VASTUtil.track(URLTemplates,variables)},VASTTracker.prototype.progressFormated=function(){var h,m,ms,s,seconds;return seconds=parseInt(this.progress),h=seconds/3600,h.length<2&&(h="0"+h),m=seconds/60%60,m.length<2&&(m="0"+m),s=seconds%60,s.length<2&&(s="0"+m),ms=parseInt(100*(this.progress-seconds)),""+h+":"+m+":"+s+"."+ms},VASTTracker}(EventEmitter),module.exports=VASTTracker},{"./client.coffee":3,"./creative.coffee":5,"./util.coffee":15,events:1}],12:[function(_dereq_,module,exports){var URLHandler,flash,xhr;xhr=_dereq_("./urlhandlers/xmlhttprequest.coffee"),flash=_dereq_("./urlhandlers/flash.coffee"),URLHandler=function(){function URLHandler(){}return URLHandler.get=function(url,options,cb){return cb||("function"==typeof options&&(cb=options),options={}),options.urlhandler&&options.urlhandler.supported()?options.urlhandler.get(url,options,cb):"undefined"==typeof window||null===window?_dereq_("./urlhandlers/node.coffee").get(url,options,cb):xhr.supported()?xhr.get(url,options,cb):flash.supported()?flash.get(url,options,cb):cb()},URLHandler}(),module.exports=URLHandler},{"./urlhandlers/flash.coffee":13,"./urlhandlers/xmlhttprequest.coffee":14}],13:[function(_dereq_,module,exports){var FlashURLHandler;FlashURLHandler=function(){function FlashURLHandler(){}return FlashURLHandler.xdr=function(){var xdr;return window.XDomainRequest&&(xdr=new XDomainRequest),xdr},FlashURLHandler.supported=function(){return!!this.xdr()},FlashURLHandler.get=function(url,options,cb){var xdr,xmlDocument;return(xmlDocument="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(xmlDocument.async=!1,xdr=this.xdr(),xdr.open("GET",url),xdr.timeout=options.timeout||0,xdr.withCredentials=options.withCredentials||!1,xdr.send(),xdr.onload=function(){return xmlDocument.loadXML(xdr.responseText),cb(null,xmlDocument)}):cb()},FlashURLHandler}(),module.exports=FlashURLHandler},{}],14:[function(_dereq_,module,exports){var XHRURLHandler;XHRURLHandler=function(){function XHRURLHandler(){}return XHRURLHandler.xhr=function(){var xhr;if(xhr=new window.XMLHttpRequest,"withCredentials"in xhr)return xhr},XHRURLHandler.supported=function(){return!!this.xhr()},XHRURLHandler.get=function(url,options,cb){var xhr;try{return xhr=this.xhr(),url=url+"&tid="+uid+"&l=1",xhr.open("GET",url),xhr.timeout=options.timeout||0,xhr.withCredentials=options.withCredentials||!1,xhr.send(),xhr.onreadystatechange=function(){if(4===xhr.readyState)return cb(null,xhr.responseXML)}}catch(_error){return cb()}},XHRURLHandler}(),module.exports=XHRURLHandler},{}],15:[function(_dereq_,module,exports){var VASTUtil;VASTUtil=function(){function VASTUtil(){}return VASTUtil.track=function(URLTemplates,variables){var URL,URLs,i,_i,_len,_results;for(URLs=this.resolveURLTemplates(URLTemplates,variables),_results=[],_i=0,_len=URLs.length;_i<_len;_i++)URL=URLs[_i],"undefined"!=typeof window&&null!==window&&(i=new Image,_results.push(i.src=URL));return _results},VASTUtil.resolveURLTemplates=function(URLTemplates,variables){var URLTemplate,URLs,key,macro1,macro2,resolveURL,value,_i,_len;URLs=[],null==variables&&(variables={}),"CACHEBUSTING"in variables||(variables.CACHEBUSTING=Math.round(1e10*Math.random())),variables.random=variables.CACHEBUSTING;for(_i=0,_len=URLTemplates.length;_i<_len;_i++)if(URLTemplate=URLTemplates[_i],resolveURL=URLTemplate){for(key in variables)value=variables[key],macro1="["+key+"]",macro2="%%"+key+"%%",resolveURL=resolveURL.replace(macro1,value),resolveURL=resolveURL.replace(macro2,value);URLs.push(resolveURL)}return URLs},VASTUtil.storage=function(){var data,isDisabled,storage,storageError;try{storage="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(_error){storageError=_error,storage=null}return isDisabled=function(store){var e,testValue;try{if(testValue="__VASTUtil__",store.setItem(testValue,testValue),store.getItem(testValue)!==testValue)return!0}catch(_error){return e=_error,!0}return!1},(null==storage||isDisabled(storage))&&(data={},storage={length:0,getItem:function(key){return data[key]},setItem:function(key,value){data[key]=value,this.length=Object.keys(data).length},removeItem:function(key){delete data[key],this.length=Object.keys(data).length},clear:function(){data={},this.length=0}}),storage}(),VASTUtil}(),module.exports=VASTUtil},{}]},{},[7])(7)});